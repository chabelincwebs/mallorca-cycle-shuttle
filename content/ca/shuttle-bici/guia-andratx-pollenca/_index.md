---
title: "Andratx a Pollen√ßa ‚Äì Guia definitiva de ciclisme"
description: "Guia completa per ciclar d'Andratx a Pollen√ßa per la Serra de Tramuntana"
---

Tria entre les nostres rutes curosament seleccionades que uneixen Port d'Andratx i Port de Pollen√ßa per la magn√≠fica Serra de Tramuntana, Patrimoni Mundial de la Unesco.

No diem que sigui f√†cil. No diem que sigui per a tothom. Diguem que √©s brillant.

Esc√®nica, amb pujades exigents i descensos llargs i fluids, tot sobre asfalt molt llis. Parades regulars a caf√®s de pobles de pedra. Parad√≠s ciclista.

<!-- INFO CARDS GRID -->
<div class="info-cards-wrapper">
<div class="info-cards-grid">
  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üì∏</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Snapshot</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Per qu√® aquesta ruta:</strong> D'una costa a l'altra per la Tramuntana vora el mar sobre asfalt llis ‚Äì el millor dia en bici a Mallorca. Probablement el teu millor dia en bici. Ever.</p>
      <p><strong>Com funciona:</strong> Bus out, bike back. Agafa el bus programat per a bicicletes fins a Port d'Andratx (o el trajecte invers fins a Port de Pollen√ßa) i torna amb una de les rutes suggerides o la teva pr√≤pia.</p>
      <p><strong>Serveis programats:</strong> Nosaltres ens encarreguem de la log√≠stica, tu relaxa't i gaudeix del millor de Mallorca. Reserva el bus programat des de qualsevol punt de sortida a la plataforma de reserves.</p>
      <p><a href="/ca/shuttle-bici/shuttle-home/">Veure horaris i reservar ‚Üí</a></p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üó∫Ô∏è</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Seccions clau</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Estellencs a Dei√†:</strong> bellesa costanera.</p>
      <p><strong>Banyalbufar:</strong> res m√©s a afegir.</p>
      <p><strong>Puig Major (des de S√≥ller):</strong> 14 km @ 6,2%, ~828 m. Llarg i constant; t√∫nel(s) il¬∑luminat(s) i despr√©s aq√ºeducte.</p>
      <p><strong>Coll dels Reis / Sa Calobra:</strong> afegit opcional ‚Äì baixa al port i torna a pujar; paelles de llista d'imprescindibles.</p>
      <p><strong>Port Valldemossa i Port des Canonge:</strong> baixades curtes i dures d'anada i tornada, panor√†miques; "mini Sa Calobra" sense tr√†nsit.</p>
      <p><strong>Coll de sa Batalla (pel costat de Lluc):</strong> porta al descens cap a Caimari i a carreteres secund√†ries fins a la carretera de la badia.</p>
      <p><strong>Coll de S√≥ller (l√≠nia alternativa):</strong> cl√†ssic sinu√≥s si evites la MA-10 alta.</p>
      <p><strong>Coll de Femenia (cara nord):</strong> pujada d'entrada sortint de Pollen√ßa cap a Lluc.</p>
      <p><strong>Coll de Femenia (cara nord):</strong> descens estil F1 de Lluc a Pollen√ßa.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">‚òï</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Caf√®s/Refor√ß</h3>
    </div>
    <div class="info-card-content">
      <p style="font-style: italic; margin-bottom: 0.5rem;">km aproximats des d'Andratx</p>
      <p><strong>Es Grau (‚âà13 km):</strong> vistes de balc√≥ sobre els penya-segats; caf√® r√†pid.</p>
      <p><strong>Estellencs (‚âà17 km):</strong> "Cafeter√≠a Estellencs" ‚Äì senzill i pr√†ctic, just a la MA-10.</p>
      <p><strong>Banyalbufar (‚âà24 km):</strong> Son Tom√†s (varietat + vistes) o Bellavista (vistes top; compte amb les bicis).</p>
      <p><strong>Valldemossa (‚âà39 km):</strong> moltes opcions; Ca'n Molinas per Cocas de Patata amb xocolata calenta.</p>
      <p><strong>Dei√† (‚âà48 km):</strong> fleca dins el supermercat de Marc & Vincent Reyn√©s; el seu caf√® tamb√© a Port de S√≥ller.</p>
      <p><strong>S√≥ller (‚âà58 km) ‚Äì Sa Frontera:</strong> men√∫ consistent abans del Puig Major.</p>
      <p><strong>Port de S√≥ller (desviament):</strong> opcions a primera l√≠nia de mar; Reyn√©s Cycling Caf√© per a past√≠s/caf√®.</p>
      <p><strong>Aq√ºeducte / desviaci√≥ Sa Calobra (‚âà80 km):</strong> OJ Shack ‚Äì suc de taronja natural + snacks per pedalar.</p>
      <p><strong>Lluc / cim del Coll de sa Batalla (‚âà89 km):</strong> Repsol + caf√® o Monestir de Lluc ‚Äì r√†pid o assegut.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üí°</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Informaci√≥ √∫til</h3>
    </div>
    <div class="info-card-content">
      <p>Reserva a l'inici del viatge quan les cames encara s√≥n fresques i, amb 308 dies de sol l'any, si la meteo obliga a cancel¬∑lar, encara tindr√†s un altre dia.</p>
      <p>Places limitades. Reserva amb temps.</p>
      <p>Ser√† sense cap dubte el teu millor dia a Mallorca.</p>
      <p>Arriba 10 minuts abans per a l'embalatge de la bici el mateix dia.</p>
      <p>√âs una sortida d'hora: molts llocs per esmorzar, caf√® i WC a l'arribada.</p>
      <p>Cobertura de rescat: tranquil¬∑litat. Molt recomanada. A vegades fallen bicis i cossos.</p>
      <p>C√†rrega segura de bicis als remolcs: entre matalassos ‚Äì estable i segura.</p>
      <p>Temps mitj√† de tornada una mica m√©s de 6 hores m√©s parades en la ruta vanilla (la m√©s curta).</p>
      <p>Els caf√®s apareixen sovint, mai m√©s d'una hora entre opcions.</p>
      <p>Refor√ßar-se regularment √©s essencial.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üïí</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Horaris</h3>
    </div>
    <div class="info-card-content">
      <p>Utilitza el bike bus cap a Port d'Andratx des de Port de Pollen√ßa/Alc√∫dia/Playa de Muro i des de Peguera, Playa de Palma i Santa Ponsa cap a Port de Pollen√ßa.</p>
      <p><a href="/ca/shuttle-bici/shuttle-home/">Veure horaris i reservar ‚Üí</a></p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">‚≠ê</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Prova social</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Testimoni "18 sueques" (2016):</strong> dia Big Daddy de 162 km anomenat "el millor dia en bici" ‚Äì els van encantar Canonge, Valldemossa, Sa Calobra; t√∫nels il¬∑luminats; final r√†pid cap a Pollen√ßa. Tornen la temporada seg√ºent.</p>
      <p><strong>John McCracken (primavera 2025):</strong> el format d'anada et permet gaudir del paisatge sense convertir-ho en un ultra; destacats: sortida Gramola, trams de cingle MA-10, aproximaci√≥ pel t√∫nel de Monn√†ber al Puig Major, descens de Femenia "deixar-se anar".</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üìä</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Dades clau</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Pujada emblem√†tica:</strong> Puig Major des de S√≥ller (sentit sud) ‚Äì 14 km @ 6,2% (‚âà828 m).</p>
      <p><strong>Descens emblem√†tic:</strong> Puig Major cap a S√≥ller (sentit nord) ‚Äì 14 km @ 6,2% (‚âà828 m).</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">üì∑</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Memory Maker!</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Port de Valldemossa:</strong> versi√≥ mini ‚Äì i potser millor? ‚Äì de Sa Calobra (baixar i pujar).</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">‚ö°</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Consells r√†pids de fuel</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Fuel r√†pid per arribar a casa:</strong> OJ Shack a l'aq√ºeducte o caf√®/benzinera de Sa Batalla (anant al Nord), Estellencs (anant al Sud).</p>
      <p><strong>Fuel esc√®nic:</strong> Banyalbufar i Dei√†.</p>
      <p>S√≥ller √©s aproximadament a mig cam√≠.</p>
      <p>Els caf√®s mai s√≥n a m√©s d'una hora.</p>
    </div>
  </div>
</div>
</div>

<!-- CSS STYLING -->
<style>
.info-cards-wrapper {
  margin: 2rem 0;
}

.info-cards-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 3rem;
}

@media (max-width: 1024px) {
  .info-cards-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  .info-cards-grid {
    grid-template-columns: 1fr;
  }
}

.info-card {
  background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 1.25rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.info-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border-color: #f10000;
}

.info-card-header {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.info-card-header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.info-card h3 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
}

.card-toggle {
  font-size: 1.5rem;
  font-weight: bold;
  color: #f10000;
  transition: transform 0.3s ease;
  user-select: none;
}

.info-card.expanded .card-toggle {
  transform: rotate(45deg);
}

.info-card-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
  margin-top: 0;
}

.info-card.expanded .info-card-content {
  max-height: 2000px;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e0e0e0;
}

.info-card-content p {
  margin: 0.75rem 0;
  line-height: 1.6;
  color: #555;
}

.info-card-content p:first-child {
  margin-top: 0;
}

.info-card-content p:last-child {
  margin-bottom: 0;
}

.info-card-content a {
  color: #f10000;
  text-decoration: none;
  font-weight: 500;
}

.info-card-content a:hover {
  text-decoration: underline;
}

.routes-section {
  margin: 3rem 0;
}

.routes-section h2 {
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  color: #333;
  border-bottom: 3px solid #f10000;
  padding-bottom: 0.5rem;
}

.route-accordion {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 1rem;
  overflow: hidden;
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.route-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.25rem;
  cursor: pointer;
  background: linear-gradient(to right, #f8f9fa 0%, #ffffff 100%);
  transition: background 0.3s ease;
}

.route-header:hover {
  background: linear-gradient(to right, #f0f0f0 0%, #f8f9fa 100%);
}

.route-title-group {
  flex: 1;
}

.route-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: #333;
  margin: 0 0 0.25rem 0;
}

.route-subtitle {
  font-size: 0.95rem;
  color: #666;
  margin: 0;
  line-height: 1.5;
}

.route-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-right: 1rem;
}

.difficulty-badge {
  padding: 0.35rem 0.75rem;
  border-radius: 4px;
  font-size: 0.85rem;
  font-weight: 600;
  white-space: nowrap;
}

.difficulty-moderate {
  background-color: #4CAF50;
  color: white;
}

.difficulty-hard {
  background-color: #FF9800;
  color: white;
}

.difficulty-very-hard {
  background-color: #f44336;
  color: white;
}

.route-toggle {
  font-size: 1.5rem;
  font-weight: bold;
  color: #f10000;
  transition: transform 0.3s ease;
  user-select: none;
}

.route-accordion.expanded .route-toggle {
  transform: rotate(45deg);
}

.route-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.route-accordion.expanded .route-content {
  max-height: 5000px;
}

.route-content-inner {
  padding: 1.5rem;
  border-top: 1px solid #e0e0e0;
  background: white;
}

.route-map {
  width: 100%;
  height: 450px;
  margin-bottom: 1.5rem;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.route-chart {
  width: 100%;
  height: 300px;
  margin-top: 1.5rem;
}
</style>

<!-- ROUTES SECTION -->
<div class="routes-section">
<h2>Rutes Nord ‚Äì Andratx ‚Üí Pollen√ßa</h2>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-vanilla">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Vanilla ‚Äì Andratx ‚Üí Pollen√ßa</h3>
      <p class="route-subtitle">Cl√†ssica directa: tram costaner SW ‚Üí S√≥ller ‚Üí Puig Major ‚Üí aq√ºeducte ‚Üí Lluc ‚Üí descens r√†pid a Pollen√ßa. La ruta de tornada m√©s directa.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Moderada</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-vanilla" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-vanilla" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-via-caimari">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Via Caimari (Vanilla+)</h3>
      <p class="route-subtitle">Com l'anterior, per√≤ continua m√©s enll√† de la Repsol a Lluc, baixa Coll de sa Batalla ‚Üí secund√†ries per Binibona/Campanet ‚Üí carretera de la badia d'Alc√∫dia ‚Üí Port de Pollen√ßa. Segona ruta m√©s directa. M√©s secund√†ries abans del final.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Moderada</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-via-caimari" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-via-caimari" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-portvalldemossa">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port Valldemossa</h3>
      <p class="route-subtitle">Secci√≥ costanera + baixar/pujar Port Valldemossa ‚Üí S√≥ller ‚Üí Puig Major ‚Üí Lluc ‚Üí descens cap a Pollen√ßa. Un gran afegit a la vanilla.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-hard">Dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-portvalldemossa" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-portvalldemossa" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-valldemossa-sacalobra">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port Valldemossa i Sa Calobra</h3>
      <p class="route-subtitle">Costa + Port Valldemossa, despr√©s Puig Major ‚Üí esquerra a l'aq√ºeducte ‚Üí Coll dels Reis ‚Üí baixa Sa Calobra, torna a pujar ‚Üí Lluc ‚Üí descens a Pollen√ßa. Dura.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Molt dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-valldemossa-sacalobra" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-valldemossa-sacalobra" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-big-daddy">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Big Daddy Challenge (8 colls classificats)</h3>
      <p class="route-subtitle">Costa + Port des Canonge + Port Valldemossa ‚Üí costat llarg del Puig Major ‚Üí aq√ºeducte ‚Üí Coll dels Reis ‚Üí Sa Calobra (baixar i pujar) ‚Üí Lluc ‚Üí Pollen√ßa/Port. Molt dura.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Molt dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-big-daddy" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-big-daddy" class="route-chart"></canvas>
    </div>
  </div>
</div>
</div>

<div class="routes-section">
<h2>Rutes Sud ‚Äì Pollen√ßa ‚Üí Andratx</h2>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-vanilla">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Vanilla ‚Äì Port de Pollen√ßa ‚Üí Port d'Andratx</h3>
      <p class="route-subtitle">Coll de Femenia ‚Üí passa Lluc/desviaci√≥ Sa Calobra ‚Üí costat f√†cil del Puig Major ‚Üí 14 km de descens fins a S√≥ller ‚Üí costa per Dei√†, Valldemossa, Banyalbufar, Estellencs ‚Üí Port d'Andratx. La ruta de tornada m√©s directa. Brillant!</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Moderada</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-vanilla" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-vanilla" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-canonge-valldemossa">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port des Canonge i Port Valldemossa</h3>
      <p class="route-subtitle">Femenia ‚Üí Lluc ‚Üí Puig Major ‚Üí S√≥ller ‚Üí costa + afegits: baixar/pujar Port des Canonge i Port Valldemossa ‚Üí final costaner sud-oest cap a Andratx.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Molt dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-canonge-valldemossa" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-canonge-valldemossa" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-puigpunyent">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Via Puigpunyent</h3>
      <p class="route-subtitle">Femenia ‚Üí Lluc ‚Üí Puig Major ‚Üí S√≥ller ‚Üí Dei√† ‚Üí Valldemossa ‚Üí Esporles ‚Üí Puigpunyent ‚Üí Galilea ‚Üí Es Capdell√† ‚Üí Port d'Andratx. Passa una estona lluny de la costa i fora del soroll.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-hard">Dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-puigpunyent" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-puigpunyent" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-big-daddy">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Big Daddy Challenge (inversa)</h3>
      <p class="route-subtitle">Concepte com l'anterior, inclosos els tres "ports" (Canonge, Valldemossa, Sa Calobra). Nom√©s per a escaladors forts.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Molt dura</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-big-daddy" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-big-daddy" class="route-chart"></canvas>
    </div>
  </div>
</div>
</div>

<!-- LEAFLET & CHART.JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
// Card toggle functionality
function toggleCard(card) {
  card.classList.toggle('expanded');
}

// Route configuration
const routeConfigs = {
  'portandratx-pollenca-vanilla': {
    gpx: '/routes/portandratx-pollenca-vanilla-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollen√ßa',
    color: '#2E7D32'
  },
  'portandratx-pollenca-via-caimari': {
    gpx: '/routes/portandratx-pollenca-via-caimari-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollen√ßa (via Caimari)',
    color: '#1976D2'
  },
  'portandratx-pollenca-portvalldemossa': {
    gpx: '/routes/portandratx-pollenca-portvalldemossa-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollen√ßa',
    color: '#F57C00'
  },
  'portandratx-pollenca-valldemossa-sacalobra': {
    gpx: '/routes/portandratx-pollenca-valldemossa-sacalobra-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollen√ßa',
    color: '#C62828'
  },
  'portandratx-pollenca-big-daddy': {
    gpx: '/routes/portandratx-pollenca-big-daddy-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollen√ßa',
    color: '#6A1B9A'
  },
  'portpollenca-portandratx-vanilla': {
    gpx: '/routes/portpollenca-portandratx-vanilla-web.gpx',
    startName: 'Port de Pollen√ßa',
    endName: 'Port d\'Andratx',
    color: '#2E7D32'
  },
  'portpollenca-portandratx-canonge-valldemossa': {
    gpx: '/routes/portpollenca-portandratx-canonge-valldemossa-web.gpx',
    startName: 'Port de Pollen√ßa',
    endName: 'Port d\'Andratx',
    color: '#C62828'
  },
  'portpollenca-portandratx-puigpunyent': {
    gpx: '/routes/portpollenca-portandratx-puigpunyent-web.gpx',
    startName: 'Port de Pollen√ßa',
    endName: 'Port d\'Andratx',
    color: '#F57C00'
  },
  'portpollenca-portandratx-big-daddy': {
    gpx: '/routes/portpollenca-portandratx-big-daddy-web.gpx',
    startName: 'Port de Pollen√ßa',
    endName: 'Port d\'Andratx',
    color: '#6A1B9A'
  }
};

// Store initialized routes
const initializedRoutes = new Set();

// Route toggle functionality
function toggleRoute(accordion) {
  const wasExpanded = accordion.classList.contains('expanded');
  accordion.classList.toggle('expanded');

  // If expanding and not yet initialized, load the route
  if (!wasExpanded) {
    const routeId = accordion.getAttribute('data-route');
    if (!initializedRoutes.has(routeId)) {
      loadRoute(routeId);
      initializedRoutes.add(routeId);
    }
  }
}

// Custom marker icons
const startIcon = L.divIcon({
  className: 'custom-marker',
  html: '<div style="background-color: #22c55e; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
  iconSize: [12, 12],
  iconAnchor: [6, 6]
});

const endIcon = L.divIcon({
  className: 'custom-marker',
  html: '<div style="background-color: #ef4444; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
  iconSize: [12, 12],
  iconAnchor: [6, 6]
});

// Load and display route
async function loadRoute(routeId) {
  const config = routeConfigs[routeId];
  if (!config) return;

  try {
    const response = await fetch(config.gpx);
    const gpxText = await response.text();
    const parser = new DOMParser();
    const gpxDoc = parser.parseFromString(gpxText, 'text/xml');

    // Extract coordinates and elevations
    const trkpts = gpxDoc.querySelectorAll('trkpt');
    const coordinates = [];
    const elevations = [];
    let distance = 0;
    const distances = [0];

    trkpts.forEach((trkpt, index) => {
      const lat = parseFloat(trkpt.getAttribute('lat'));
      const lon = parseFloat(trkpt.getAttribute('lon'));
      const ele = parseFloat(trkpt.querySelector('ele')?.textContent || 0);

      coordinates.push({ lat, lon });
      elevations.push(ele);

      if (index > 0) {
        const prev = coordinates[index - 1];
        const R = 6371; // Earth's radius in km
        const dLat = (lat - prev.lat) * Math.PI / 180;
        const dLon = (lon - prev.lon) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(prev.lat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        distance += R * c;
        distances.push(distance);
      }
    });

    // Create map
    const mapDiv = document.getElementById(`map-${routeId}`);
    const map = L.map(mapDiv).setView([coordinates[0].lat, coordinates[0].lon], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // Draw route
    const latlngs = coordinates.map(c => [c.lat, c.lon]);
    L.polyline(latlngs, { color: config.color, weight: 4, opacity: 0.7 }).addTo(map);

    // Add markers
    const lastIdx = coordinates.length - 1;
    L.marker([coordinates[0].lat, coordinates[0].lon], { icon: startIcon })
      .addTo(map)
      .bindPopup('<strong>Sortida:</strong> ' + config.startName);

    L.marker([coordinates[lastIdx].lat, coordinates[lastIdx].lon], { icon: endIcon })
      .addTo(map)
      .bindPopup('<strong>Arribada:</strong> ' + config.endName);

    // Fit bounds
    map.fitBounds(latlngs);

    // Create elevation chart
    const ctx = document.getElementById(`chart-${routeId}`).getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: distances.map(d => d.toFixed(1)),
        datasets: [{
          label: 'Altitud (m)',
          data: elevations,
          borderColor: config.color,
          backgroundColor: config.color + '33',
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              title: (context) => 'Dist√†ncia: ' + context[0].label + ' km',
              label: (context) => 'Altitud: ' + context.parsed.y.toFixed(0) + ' m'
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Dist√†ncia (km)' },
            grid: { display: false }
          },
          y: {
            title: { display: true, text: 'Altitud (m)' },
            beginAtZero: false
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        }
      }
    });

  } catch (error) {
    console.error('Error loading route:', error);
  }
}
</script>
