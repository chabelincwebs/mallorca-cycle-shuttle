---
title: "Andratx–Pollença – Guide ultime du cyclisme"
description: "Guide complet pour rouler d'Andratx à Pollença à travers la Tramuntana"
---

Choisissez parmi nos itinéraires soigneusement sélectionnés reliant Port d'Andratx et Port de Pollença via la magnifique Serra de Tramuntana, classée au patrimoine mondial de l'Unesco.

On ne dit pas que c'est facile. On ne dit pas que c'est pour tout le monde. On dit que c'est génial.

Scénique avec des montées exigeantes et de longues descentes fluides, le tout sur un asphalte ultra lisse. Arrêts cafés réguliers dans des villages en pierre. Paradis du cycliste.

<!-- INFO CARDS GRID -->
<div class="info-cards-wrapper">
<div class="info-cards-grid">
  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">📸</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Snapshot</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Pourquoi cet itinéraire :</strong> D'une côte à l'autre dans la Tramuntana le long du littoral sur revêtement lisse – la meilleure journée à vélo de Majorque. Probablement ta meilleure journée à vélo. Ever.</p>
      <p><strong>Comment ça marche :</strong> Bus out, bike back. Prends le bus vélo programmé jusqu'à Port d'Andratx (ou l'inverse vers Port de Pollença), puis reviens par l'un des itinéraires proposés ou le tien.</p>
      <p><strong>Services programmés :</strong> On gère la logistique, tu profites du meilleur de Majorque. Réserve le bus programmé depuis l'un des lieux de départ sur la plateforme.</p>
      <p><a href="/fr/bike-shuttle/shuttle-home/">Voir les horaires et réserver →</a></p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">🗺️</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Sections clés</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Estellencs à Deià :</strong> beauté côtière.</p>
      <p><strong>Banyalbufar :</strong> tout est dit.</p>
      <p><strong>Puig Major (depuis Sóller) :</strong> 14 km @ 6,2 %, ~828 m. Long et régulier ; tunnel(s) éclairé(s) puis aqueduc.</p>
      <p><strong>Coll dels Reis / Sa Calobra :</strong> optionnel – descente au port puis remontée ; lacets de bucket list.</p>
      <p><strong>Port Valldemossa & Port des Canonge :</strong> courtes descentes aller/retour, raides et panoramiques ; "mini Sa Calobra" sans trafic.</p>
      <p><strong>Coll de sa Batalla (côté Lluc) :</strong> mène à la descente sur Caimari et aux routes secondaires vers la route de la baie.</p>
      <p><strong>Coll de Sóller (ligne alt.) :</strong> classique sinueux si tu évites la haute MA-10.</p>
      <p><strong>Coll de Femenia (nord) :</strong> montée de départ en quittant Pollença vers Lluc.</p>
      <p><strong>Coll de Femenia (nord) :</strong> descente style F1 de Lluc vers Pollença.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">☕</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Cafés/Ravitaillement</h3>
    </div>
    <div class="info-card-content">
      <p style="font-style: italic; margin-bottom: 0.5rem;">km estimés depuis Andratx</p>
      <p><strong>Es Grau (≈13 km) :</strong> vues en balcon sur les falaises ; café rapide.</p>
      <p><strong>Estellencs (≈17 km) :</strong> « Cafetería Estellencs » – simple et pratique, juste sur la MA-10.</p>
      <p><strong>Banyalbufar (≈24 km) :</strong> Son Tomàs (choix + vues) ou Bellavista (vues top ; attention aux vélos).</p>
      <p><strong>Valldemossa (≈39 km) :</strong> nombreuses options ; Ca'n Molinas pour Cocas de Patata avec chocolat chaud.</p>
      <p><strong>Deià (≈48 km) :</strong> boulangerie dans le supermarché de Marc & Vincent Reynés ; leur café aussi à Port de Sóller.</p>
      <p><strong>Sóller (≈58 km) – Sa Frontera :</strong> menu solide avant Puig Major.</p>
      <p><strong>Port de Sóller (détour) :</strong> options sur le front de mer ; Reynés Cycling Café pour gâteau/café.</p>
      <p><strong>Aqueduc / bifurcation Sa Calobra (≈80 km) :</strong> OJ Shack – jus d'orange frais + snacks pour rouler.</p>
      <p><strong>Lluc / sommet Coll de sa Batalla (≈89 km) :</strong> Repsol + café ou Monastère de Lluc – express ou assis.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">💡</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Bon à savoir</h3>
    </div>
    <div class="info-card-content">
      <p>Réserve tôt dans ton séjour, quand les jambes sont fraîches, et avec 308 jours de soleil par an, si la météo annule, tu auras un autre jour.</p>
      <p>Places limitées. Réserve tôt.</p>
      <p>Ce sera sans aucun doute ta meilleure journée à Majorque.</p>
      <p>Arrive 10 minutes en avance pour le chargement des vélos le jour J.</p>
      <p>Départ matinal : nombreux endroits pour petit-déjeuner, café, WC à l'arrivée.</p>
      <p>Couverture rescue : tranquillité d'esprit. Fortement conseillée. Parfois les vélos et les corps cèdent.</p>
      <p>Chargement sécurisé des vélos dans les remorques : entre matelas – stable et sûr.</p>
      <p>Temps moyen de retour un peu plus de 6 heures plus les arrêts sur la route vanilla (la plus courte).</p>
      <p>Les cafés sont réguliers, jamais plus d'une heure entre deux.</p>
      <p>Le ravitaillement régulier est essentiel.</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">🕒</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Horaires</h3>
    </div>
    <div class="info-card-content">
      <p>Utilise le bike bus vers Port d'Andratx depuis Port de Pollença/Alcúdia/Playa de Muro et depuis Peguera, Playa de Palma et Santa Ponsa vers Port de Pollença.</p>
      <p><a href="/fr/bike-shuttle/shuttle-home/">Voir les horaires et réserver →</a></p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">⭐</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Preuves sociales</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Témoignage « 18 Suédoises » (2016) :</strong> journée Big Daddy de 162 km qualifiée de « meilleure journée à vélo » – adoré Canonge, Valldemossa, Sa Calobra ; tunnels éclairés ; finish rapide vers Pollença. De retour la saison suivante.</p>
      <p><strong>John McCracken (printemps 2025) :</strong> le format aller simple permet de profiter des paysages sans en faire un ultra ; points forts : départ Gramola, sections de falaises MA-10, approche du Puig Major par le tunnel de Monnàber, descente Femenia « lâche tout ».</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">📊</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Statistiques clés</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Montée signature :</strong> Puig Major depuis Sóller (vers le sud) – 14 km @ 6,2 % (≈828 m).</p>
      <p><strong>Descente signature :</strong> Puig Major vers Sóller (vers le nord) – 14 km @ 6,2 % (≈828 m).</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">📷</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Memory Maker !</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Port de Valldemossa :</strong> version mini – et peut-être meilleure ? – de Sa Calobra (descendre et remonter).</p>
    </div>
  </div>

  <div class="info-card" onclick="toggleCard(this)">
    <div class="info-card-header">
      <div class="info-card-header-top">
        <span style="font-size: 1.5rem;">⚡</span>
        <span class="card-toggle">+</span>
      </div>
      <h3>Astuces fuel rapides</h3>
    </div>
    <div class="info-card-content">
      <p><strong>Fuel rapide pour rentrer :</strong> OJ Shack à l'aqueduc ou café/garage Sa Batalla (vers le Nord), Estellencs (vers le Sud).</p>
      <p><strong>Fuel scénique :</strong> Banyalbufar & Deià.</p>
      <p>Sóller est à peu près à mi-chemin.</p>
      <p>Les cafés ne sont jamais à plus d'une heure.</p>
    </div>
  </div>
</div>
</div>

<!-- CSS STYLING -->
<style>
.info-cards-wrapper {
  margin: 2rem 0;
}

.info-cards-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  margin-bottom: 3rem;
}

@media (max-width: 1024px) {
  .info-cards-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 640px) {
  .info-cards-grid {
    grid-template-columns: 1fr;
  }
}

.info-card {
  background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 1.25rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.info-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border-color: #f10000;
}

.info-card-header {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.info-card-header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.info-card h3 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
}

.card-toggle {
  font-size: 1.5rem;
  font-weight: bold;
  color: #f10000;
  transition: transform 0.3s ease;
  user-select: none;
}

.info-card.expanded .card-toggle {
  transform: rotate(45deg);
}

.info-card-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
  margin-top: 0;
}

.info-card.expanded .info-card-content {
  max-height: 2000px;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e0e0e0;
}

.info-card-content p {
  margin: 0.75rem 0;
  line-height: 1.6;
  color: #555;
}

.info-card-content p:first-child {
  margin-top: 0;
}

.info-card-content p:last-child {
  margin-bottom: 0;
}

.info-card-content a {
  color: #f10000;
  text-decoration: none;
  font-weight: 500;
}

.info-card-content a:hover {
  text-decoration: underline;
}

.routes-section {
  margin: 3rem 0;
}

.routes-section h2 {
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  color: #333;
  border-bottom: 3px solid #f10000;
  padding-bottom: 0.5rem;
}

.route-accordion {
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 1rem;
  overflow: hidden;
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.route-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.25rem;
  cursor: pointer;
  background: linear-gradient(to right, #f8f9fa 0%, #ffffff 100%);
  transition: background 0.3s ease;
}

.route-header:hover {
  background: linear-gradient(to right, #f0f0f0 0%, #f8f9fa 100%);
}

.route-title-group {
  flex: 1;
}

.route-title {
  font-size: 1.3rem;
  font-weight: 600;
  color: #333;
  margin: 0 0 0.25rem 0;
}

.route-subtitle {
  font-size: 0.95rem;
  color: #666;
  margin: 0;
  line-height: 1.5;
}

.route-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-right: 1rem;
}

.difficulty-badge {
  padding: 0.35rem 0.75rem;
  border-radius: 4px;
  font-size: 0.85rem;
  font-weight: 600;
  white-space: nowrap;
}

.difficulty-moderate {
  background-color: #4CAF50;
  color: white;
}

.difficulty-hard {
  background-color: #FF9800;
  color: white;
}

.difficulty-very-hard {
  background-color: #f44336;
  color: white;
}

.difficulty-epic {
  background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
  color: #000;
  border: 2px solid #FFA500;
  font-weight: 900;
  box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
}

.route-toggle {
  font-size: 1.5rem;
  font-weight: bold;
  color: #f10000;
  transition: transform 0.3s ease;
  user-select: none;
}

.route-accordion.expanded .route-toggle {
  transform: rotate(45deg);
}

.route-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.route-accordion.expanded .route-content {
  max-height: 5000px;
}

.route-content-inner {
  padding: 1.5rem;
  border-top: 1px solid #e0e0e0;
  background: white;
}

.route-map {
  width: 100%;
  height: 450px;
  margin-bottom: 1.5rem;
  border-radius: 8px;
  border: 1px solid #ddd;
}

.route-chart {
  width: 100%;
  height: 300px;
  margin-top: 1.5rem;
}
</style>

<!-- ROUTES SECTION -->
<div class="routes-section">
<h2>Itinéraires Nord – Andratx → Pollença</h2>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-vanilla">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Vanilla – Andratx → Pollença</h3>
      <p class="route-subtitle">Classique direct : côte sud-ouest → Sóller → Puig Major → aqueduc → Lluc → descente rapide vers Pollença. Le retour le plus direct.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Modéré</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-vanilla" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-vanilla" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-via-caimari">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Via Caimari (Vanilla+)</h3>
      <p class="route-subtitle">Comme ci-dessus, mais continue après la Repsol à Lluc, descends Coll de sa Batalla → petites routes via Binibona/Campanet → route de la baie d'Alcúdia → Port de Pollença. Deuxième retour le plus direct. Plus de petites routes avant l'arrivée.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Modéré</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-via-caimari" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-via-caimari" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-portvalldemossa">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port Valldemossa</h3>
      <p class="route-subtitle">Section côtière + aller/retour Port Valldemossa → Sóller → Puig Major → Lluc → descente vers Pollença. Super ajout à la vanilla.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-hard">Difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-portvalldemossa" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-portvalldemossa" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-valldemossa-sacalobra">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port Valldemossa & Sa Calobra</h3>
      <p class="route-subtitle">Côte + Port Valldemossa, puis Puig Major → à gauche à l'aqueduc → Coll dels Reis → descends Sa Calobra, remonte → Lluc → descente vers Pollença. Difficile.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Très difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-valldemossa-sacalobra" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-valldemossa-sacalobra" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portandratx-pollenca-big-daddy">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Big Daddy Challenge (8 cols classés)</h3>
      <p class="route-subtitle">Côte + Port des Canonge + Port Valldemossa → grand côté de Puig Major → aqueduc → Coll dels Reis → Sa Calobra (descente & montée) → Lluc → Pollença/Port. Très difficile.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Très difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portandratx-pollenca-big-daddy" class="route-map"></div>
      <canvas id="chart-portandratx-pollenca-big-daddy" class="route-chart"></canvas>
    </div>
  </div>
</div>
</div>

<div class="routes-section">
<h2>Itinéraires Sud – Pollença → Andratx</h2>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-vanilla">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Vanilla – Port de Pollença → Port d'Andratx</h3>
      <p class="route-subtitle">Coll de Femenia → passer Lluc/bifurcation Sa Calobra → côté facile de Puig Major → 14 km de descente vers Sóller → côte via Deià, Valldemossa, Banyalbufar, Estellencs → Port d'Andratx. Le retour le plus direct. Brillant !</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-moderate">Modéré</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-vanilla" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-vanilla" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-canonge-valldemossa">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Incl. Port des Canonge & Port Valldemossa</h3>
      <p class="route-subtitle">Femenia → Lluc → Puig Major → Sóller → côte + extras : aller/retour Port des Canonge et Port Valldemossa → finish côtier sud-ouest vers Andratx.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Très difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-canonge-valldemossa" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-canonge-valldemossa" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-puigpunyent">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Via Puigpunyent</h3>
      <p class="route-subtitle">Femenia → Lluc → Puig Major → Sóller → Deià → Valldemossa → Esporles → Puigpunyent → Galilea → Es Capdellà → Port d'Andratx. Un peu loin du littoral et hors des sentiers battus.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-hard">Difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-puigpunyent" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-puigpunyent" class="route-chart"></canvas>
    </div>
  </div>
</div>

<div class="route-accordion" onclick="toggleRoute(this)" data-route="portpollenca-portandratx-big-daddy">
  <div class="route-header">
    <div class="route-title-group">
      <h3 class="route-title">Big Daddy Challenge (inverse)</h3>
      <p class="route-subtitle">Même concept, incluant les trois « ports » (Canonge, Valldemossa, Sa Calobra). Pour grimpeurs solides seulement.</p>
    </div>
    <div class="route-meta">
      <span class="difficulty-badge difficulty-very-hard">Très difficile</span>
      <span class="route-toggle">+</span>
    </div>
  </div>
  <div class="route-content">
    <div class="route-content-inner">
      <div id="map-portpollenca-portandratx-big-daddy" class="route-map"></div>
      <canvas id="chart-portpollenca-portandratx-big-daddy" class="route-chart"></canvas>
    </div>
  </div>
</div>
</div>

<!-- LEAFLET & CHART.JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
// Card toggle functionality
function toggleCard(card) {
  card.classList.toggle('expanded');
}

// Route configuration
const routeConfigs = {
  'portandratx-pollenca-vanilla': {
    gpx: '/routes/portandratx-pollenca-vanilla-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollença',
    color: '#2E7D32'
  },
  'portandratx-pollenca-via-caimari': {
    gpx: '/routes/portandratx-pollenca-via-caimari-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollença (via Caimari)',
    color: '#1976D2'
  },
  'portandratx-pollenca-portvalldemossa': {
    gpx: '/routes/portandratx-pollenca-portvalldemossa-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollença',
    color: '#F57C00'
  },
  'portandratx-pollenca-valldemossa-sacalobra': {
    gpx: '/routes/portandratx-pollenca-valldemossa-sacalobra-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollença',
    color: '#C62828'
  },
  'portandratx-pollenca-big-daddy': {
    gpx: '/routes/portandratx-pollenca-big-daddy-web.gpx',
    startName: 'Port d\'Andratx',
    endName: 'Port de Pollença',
    color: '#6A1B9A'
  },
  'portpollenca-portandratx-vanilla': {
    gpx: '/routes/portpollenca-portandratx-vanilla-web.gpx',
    startName: 'Port de Pollença',
    endName: 'Port d\'Andratx',
    color: '#2E7D32'
  },
  'portpollenca-portandratx-canonge-valldemossa': {
    gpx: '/routes/portpollenca-portandratx-canonge-valldemossa-web.gpx',
    startName: 'Port de Pollença',
    endName: 'Port d\'Andratx',
    color: '#C62828'
  },
  'portpollenca-portandratx-puigpunyent': {
    gpx: '/routes/portpollenca-portandratx-puigpunyent-web.gpx',
    startName: 'Port de Pollença',
    endName: 'Port d\'Andratx',
    color: '#F57C00'
  },
  'portpollenca-portandratx-big-daddy': {
    gpx: '/routes/portpollenca-portandratx-big-daddy-web.gpx',
    startName: 'Port de Pollença',
    endName: 'Port d\'Andratx',
    color: '#6A1B9A'
  }
};

// Store initialized routes
const initializedRoutes = new Set();

// Route toggle functionality
function toggleRoute(accordion) {
  const wasExpanded = accordion.classList.contains('expanded');
  accordion.classList.toggle('expanded');

  // If expanding and not yet initialized, load the route
  if (!wasExpanded) {
    const routeId = accordion.getAttribute('data-route');
    if (!initializedRoutes.has(routeId)) {
      loadRoute(routeId);
      initializedRoutes.add(routeId);
    }
  }
}

// Custom marker icons
const startIcon = L.divIcon({
  className: 'custom-marker',
  html: '<div style="background-color: #22c55e; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
  iconSize: [12, 12],
  iconAnchor: [6, 6]
});

const endIcon = L.divIcon({
  className: 'custom-marker',
  html: '<div style="background-color: #ef4444; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
  iconSize: [12, 12],
  iconAnchor: [6, 6]
});

// Load and display route
async function loadRoute(routeId) {
  const config = routeConfigs[routeId];
  if (!config) return;

  try {
    const response = await fetch(config.gpx);
    const gpxText = await response.text();
    const parser = new DOMParser();
    const gpxDoc = parser.parseFromString(gpxText, 'text/xml');

    // Extract coordinates and elevations
    const trkpts = gpxDoc.querySelectorAll('trkpt');
    const coordinates = [];
    const elevations = [];
    let distance = 0;
    const distances = [0];

    trkpts.forEach((trkpt, index) => {
      const lat = parseFloat(trkpt.getAttribute('lat'));
      const lon = parseFloat(trkpt.getAttribute('lon'));
      const ele = parseFloat(trkpt.querySelector('ele')?.textContent || 0);

      coordinates.push({ lat, lon });
      elevations.push(ele);

      if (index > 0) {
        const prev = coordinates[index - 1];
        const R = 6371; // Earth's radius in km
        const dLat = (lat - prev.lat) * Math.PI / 180;
        const dLon = (lon - prev.lon) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(prev.lat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        distance += R * c;
        distances.push(distance);
      }
    });

    // Create map
    const mapDiv = document.getElementById(`map-${routeId}`);
    const map = L.map(mapDiv).setView([coordinates[0].lat, coordinates[0].lon], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Draw route
    const latlngs = coordinates.map(c => [c.lat, c.lon]);
    L.polyline(latlngs, { color: config.color, weight: 4, opacity: 0.7 }).addTo(map);

    // Add markers
    const lastIdx = coordinates.length - 1;
    L.marker([coordinates[0].lat, coordinates[0].lon], { icon: startIcon })
      .addTo(map)
      .bindPopup('<strong>Départ :</strong> ' + config.startName);

    L.marker([coordinates[lastIdx].lat, coordinates[lastIdx].lon], { icon: endIcon })
      .addTo(map)
      .bindPopup('<strong>Arrivée :</strong> ' + config.endName);

    // Fit bounds
    map.fitBounds(latlngs);

    // Create elevation chart
    const ctx = document.getElementById(`chart-${routeId}`).getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: distances.map(d => d.toFixed(1)),
        datasets: [{
          label: 'Altitude (m)',
          data: elevations,
          borderColor: config.color,
          backgroundColor: config.color + '33',
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              title: (context) => 'Distance : ' + context[0].label + ' km',
              label: (context) => 'Altitude : ' + context.parsed.y.toFixed(0) + ' m'
            }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Distance (km)' },
            grid: { display: false }
          },
          y: {
            title: { display: true, text: 'Altitude (m)' },
            beginAtZero: false
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        }
      }
    });

  } catch (error) {
    console.error('Error loading route:', error);
  }
}
</script>

<!-- Finisher's T-Shirt Product -->
<div id="finishers-gear" class="finishers-tshirt-horizontal" style="margin: 4rem auto 2rem; max-width: 1000px; scroll-margin-top: 2rem;">
<a href="https://mallorcacycleshuttle.company.site/products/Andratx-Pollenca-Finishers-Unisex-Classic-T-p788401800" target="_blank" rel="noopener noreferrer" style="text-decoration: none; display: block;">
<div style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 1rem; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-wrap: wrap; align-items: center;">
<div style="flex: 1 1 350px; min-width: 300px;">
<img src="/img/finishers-tshirt-andratx-pollenca.webp" alt="Andratx-Pollença Finisher's T-Shirt" style="width: 100%; height: 100%; object-fit: cover; display: block;">
</div>
<div style="flex: 1 1 400px; padding: 2.5rem;">
<h2 style="color: var(--brand, #f10000); margin-bottom: 0.75rem; font-size: 1.75rem; font-weight: 700;">Célébrez votre parcours</h2>
<h3 style="color: #333; font-size: 1.2rem; font-weight: 600; margin-bottom: 0.75rem;">T-shirt Finisher Andratx-Pollença</h3>
<p style="color: #666; font-size: 1rem; margin-bottom: 1.5rem; line-height: 1.6;">Célébrez la réalisation de cet itinéraire épique avec notre t-shirt finisher exclusif. Disponible en plusieurs couleurs et tailles.</p>
<div style="display: inline-block; padding: 0.9rem 2rem; background: linear-gradient(135deg, var(--brand, #f10000) 0%, #ff3333 100%); color: white; border-radius: 0.5rem; font-size: 1rem; font-weight: 700; box-shadow: 0 4px 15px rgba(241, 0, 0, 0.3);">
Acheter maintenant →
</div>
</div>
</div>
</a>
</div>

<style>
/* Hover effects for finisher's t-shirt */
.finishers-tshirt-horizontal a > div:hover {
transform: translateY(-4px);
box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

/* Mobile responsive */
@media (max-width: 768px) {
.finishers-tshirt-horizontal > a > div {
flex-direction: column;
}

.finishers-tshirt-horizontal > a > div > div:first-child {
max-height: 350px;
}
}
</style>
