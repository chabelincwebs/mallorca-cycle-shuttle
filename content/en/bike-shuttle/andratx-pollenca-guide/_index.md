---
title: "Andratx to Pollen√ßa Master Cycling Guide"
description: "Complete guide for cycling from Andratx to Pollen√ßa through the Tramuntana mountains"
---

Choose from our carefully curated routes connecting Port d'Andratx and Port de Pollen√ßa through Mallorca's stunning UNESCO World Heritage Serra de Tramuntana mountains.

We are not saying it is easy. We are not saying it is for everyone. We are saying that it is brilliant.

Scenic with challenging climbs and sweeping descents, all on butter smooth tarmac. Regular caf√© stops in stone villages. Cycling paradise.

<!-- INFO CARDS GRID -->
<div class="info-cards-wrapper">
<div class="info-cards-grid">

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üì∏</span>
<span class="card-toggle">+</span>
</div>
<h3>Snapshot</h3>
</div>
<div class="info-card-content">
<p><strong>Why this route:</strong> Coast-to-coast through the Tramuntana mountain range along the coast on smooth tarmac ‚Äì Mallorca's best day on a bike. Probably your best day on a bike. Ever.</p>
<p><strong>How it works:</strong> Bus out, bike back. Take the scheduled bike bus to Port d'Andratx (or the reverse to Port de Pollen√ßa), ride one of the suggested or your own custom route back.</p>
<p><strong>Scheduled services:</strong> We take care of the logistics, you take care of relaxing into the best Mallorca has to offer. Book the <a href="https://mallorcacycleshuttle.company.site/products/Scheduled-Bike-Buses-c15728235" target="_blank" rel="noopener noreferrer">scheduled bike bus</a> from any of the departure locations on the booking platform.</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üîë</span>
<span class="card-toggle">+</span>
</div>
<h3>Key Sections</h3>
</div>
<div class="info-card-content">
<p><strong>Estellencs to Dei√†:</strong> Coastal beauty.</p>
<p><strong>Banyalbufar:</strong> Enough said.</p>
<p><strong>Puig Major (from S√≥ller):</strong> 14 km @ 6.2%, ~828 m. Long, steady; lit tunnel(s) then aqueduct.</p>
<p><strong>Coll dels Reis / Sa Calobra:</strong> Optional add-on ‚Äì descend to port, climb back; bucket-list hairpins.</p>
<p><strong>Port Valldemossa & Port des Canonge:</strong> Short, steep, scenic dead-end descents and returns; "mini Sa Calobra" feel without the traffic.</p>
<p><strong>Coll de Sa Bataia (from Lluc side):</strong> Leads to Caimari descent and lanes to the bay road.</p>
<p><strong>Coll de S√≥ller (alt. line):</strong> Winding classic if avoiding the MA-10 high route.</p>
<p><strong>Coll de Femenia (north side):</strong> Gateway climb leaving Pollen√ßa toward Lluc.</p>
<p><strong>Coll de Femenia (north side):</strong> Gateway F1 style descent from Lluc to Pollen√ßa.</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">‚òï</span>
<span class="card-toggle">+</span>
</div>
<h3>Caf√©/Refuel Stops</h3>
</div>
<div class="info-card-content">
<p><em>km estimates from Andratx</em></p>
<p><strong>Es Grau (‚âà13 km):</strong> Balcony views over the cliffs; quick coffee.</p>
<p><strong>Estellencs (‚âà17 km):</strong> "Cafeter√≠a Estellencs" ‚Äì Simple, handy, right on MA-10.</p>
<p><strong>Banyalbufar (‚âà24 km):</strong> Son Tom√°s (range + views) or Bellavista (great views; watch the bikes).</p>
<p><strong>Valldemossa (‚âà39 km):</strong> Multiple options; Ca'n Molinas for Cocas de Patata with hot chocolate.</p>
<p><strong>Dei√† (‚âà48 km):</strong> Bakery in the supermarket run by Marc & Vincent Reyn√©s; their caf√© in Port de S√≥ller too.</p>
<p><strong>S√≥ller (‚âà58 km) ‚Äì Sa Frontera:</strong> Solid menu before Puig Major.</p>
<p><strong>Port de S√≥ller (detour):</strong> Waterfront options; Reyn√©s Cycling Caf√© for cake/coffee.</p>
<p><strong>Aqueduct / Sa Calobra turn (‚âà80 km):</strong> OJ Shack ‚Äì fresh orange juice + on-bike snacks.</p>
<p><strong>Lluc / Coll de sa Bataia top (‚âà89 km):</strong> Repsol + caf√© or Lluc Monastery ‚Äì quick or sit-down.</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üí°</span>
<span class="card-toggle">+</span>
</div>
<h3>Good to Know</h3>
</div>
<div class="info-card-content">
<ul>
<li>Book for early in your trip whilst legs are still fresh & even with 308 days of sun each year, if weather causes a cancellation, you still have an alternate day.</li>
<li>Seats are limited. Book early.</li>
<li>This will be without a doubt your best day in Mallorca.</li>
<li>Arrive 10 minutes early for bike packing on the day.</li>
<li>It's an early start, plenty of places for breakfast, coffee, toilet on arrival.</li>
<li><strong>Rescue cover:</strong> <a href="https://mallorcacycleshuttle.company.site/products/Rescue-&-Recovery-c15728236" target="_blank" rel="noopener noreferrer">Peace of mind</a>. Strongly advised. Bikes and bodies do sometimes break down.</li>
<li>Safe loading of bikes in the trailers: Packed between mattresses ‚Äì secure and safe.</li>
<li>Average return time is just over 6 hours plus stops on the vanilla (shortest) route.</li>
<li>Cafe stops appear regularly, choices are never more than an hour apart.</li>
<li>Regular fuelling is essential.</li>
</ul>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üìÖ</span>
<span class="card-toggle">+</span>
</div>
<h3>Schedule</h3>
</div>
<div class="info-card-content">
<p>Use the bike bus to Port d'Andratx from Port de Pollen√ßa/Alc√∫dia/Playa de Muro and from Peguera, Playa de Palma & Santa Ponsa to Port de Pollen√ßa.</p>
<p><a href="https://mallorcacycleshuttle.company.site/products/Scheduled-Bike-Buses-c15728235" target="_blank" rel="noopener noreferrer" class="cta">View Schedule & Book ‚Üí</a></p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">‚≠ê</span>
<span class="card-toggle">+</span>
</div>
<h3>Social Proof</h3>
</div>
<div class="info-card-content">
<p><strong>"18 Swedish ladies" testimonial (2016):</strong> 162 km Big Daddy day called "best ever day on a bike" ‚Äì loved Canonge, Valldemossa, Sa Calobra; tunnels lit; fast finish to Pollen√ßa. Returning the next season.</p>
<p><strong>John McCracken (spring 2025):</strong> One-way format lets you enjoy the scenery without turning it into an ultra-distance day; highlights: Gramola start, MA-10 cliff sections, Monn√†ber tunnel approach to Puig Major, Femenia descent "let go."</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üìä</span>
<span class="card-toggle">+</span>
</div>
<h3>Key Stats</h3>
</div>
<div class="info-card-content">
<p><strong>Signature climb:</strong> Puig Major from S√≥ller (southbound) ‚Äì 14 km @ 6.2% (‚âà828 m).</p>
<p><strong>Signature descent:</strong> Puig Major to S√≥ller (northbound) ‚Äì 14 km @ 6.2% (‚âà828 m).</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üì∑</span>
<span class="card-toggle">+</span>
</div>
<h3>Memory Maker!</h3>
</div>
<div class="info-card-content">
<p><strong>Port de Valldemossa:</strong> Mini & maybe better? version of Sa Calobra (down & back).</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üç∞</span>
<span class="card-toggle">+</span>
</div>
<h3>Quick Fuel Tips</h3>
</div>
<div class="info-card-content">
<p><strong>Quick fuel to get you home:</strong> OJ shack at the aqueduct or Sa Bataia caf√©/garage (going North), Estellencs (going South).</p>
<p><strong>Scenic fuel:</strong> Banyalbufar & Dei√†.</p>
<p><strong>Soller is approximately halfway.</strong></p>
<p><strong>Cafes are never more than an hour apart.</strong></p>
</div>
</div>

<div class="info-card" onclick="smoothScrollToProduct(event)" style="cursor: pointer;">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üëï</span>
<span class="card-toggle">+</span>
</div>
<h3>Finisher's Gear</h3>
</div>
<div class="info-card-content">
<p><strong>Celebrate your achievement!</strong></p>
<p>Get your exclusive Port d'Andratx-Port de Pollen√ßa finisher's t-shirt and show the world you conquered this epic route.</p>
<p style="color: var(--brand, #f10000); font-weight: 700; margin-top: 1rem;">Shop Now ‚Üí</p>
</div>
</div>

<div class="info-card" onclick="window.open('https://mallorcacycleshuttle.company.site/products/Departure-towns-c28971057', '_blank')" style="cursor: pointer;">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üöå</span>
<span class="card-toggle">+</span>
</div>
<h3>Book Your Shuttle</h3>
</div>
<div class="info-card-content">
<p><strong>Need a ride to start your adventure?</strong></p>
<p>Browse all departure towns and book your shuttle to Port d'Andratx or Port de Pollen√ßa. We've got you covered!</p>
<p style="color: var(--brand, #f10000); font-weight: 700; margin-top: 1rem;">View Shuttles ‚Üí</p>
</div>
</div>

<div class="info-card" onclick="toggleCard(this)">
<div class="info-card-header">
<div class="info-card-header-top">
<span style="font-size: 1.5rem;">üìã</span>
<span class="card-toggle">+</span>
</div>
<h3>Coming Soon</h3>
</div>
<div class="info-card-content">
<p><strong>More information coming soon...</strong></p>
<p>Check back later for additional resources and tips for your Port d'Andratx-Port de Pollen√ßa adventure.</p>
</div>
</div>

</div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* Info Cards Wrapper */
.info-cards-wrapper {
  margin: 2rem 0 3rem 0;
}

/* Info Cards Grid */
.info-cards-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}

@media (min-width: 768px) {
  .info-cards-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1024px) {
  .info-cards-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Hide all cards when one is expanded */
.info-cards-grid.has-expanded .info-card {
  display: none;
}

/* Show only the expanded card */
.info-cards-grid.has-expanded .info-card.expanded {
  display: block;
}

/* Routes 2-Column Layout */
.routes-2col-wrapper {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
  margin: 2rem 0 1rem 0;
}

@media (min-width: 768px) {
  .routes-2col-wrapper {
    grid-template-columns: repeat(2, 1fr);
  }
}

.routes-column {
  display: flex;
  flex-direction: column;
  gap: 0;
}

/* Hide all routes when one is expanded */
.routes-2col-wrapper.has-expanded .route-item {
  display: none;
}

/* Show only the expanded route */
.routes-2col-wrapper.has-expanded .route-item.active {
  display: block;
}

/* Make the column containing the active route span full width */
.routes-2col-wrapper.has-expanded .routes-column:has(.route-item.active) {
  grid-column: 1 / -1;
}

/* Hide empty columns when a route is expanded */
.routes-2col-wrapper.has-expanded .routes-column:not(:has(.route-item.active)) {
  display: none;
}

.info-card {
  background: white;
  border: 2px solid #ddd;
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.info-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border-color: var(--brand);
}

.info-card.expanded {
  box-shadow: 0 8px 30px rgba(241,0,0,0.2);
  border-color: var(--brand);
  grid-column: 1 / -1;
}

.info-card-header {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding: 1.25rem;
  background: linear-gradient(135deg, #fafafa 0%, #fff 100%);
  user-select: none;
}

.info-card.expanded .info-card-header {
  background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
}

.info-card-header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.info-card-header h3 {
  margin: 0;
  font-size: 1.1rem;
  color: var(--text);
  font-weight: 600;
}

.card-toggle {
  font-size: 1.5rem;
  font-weight: 300;
  color: var(--brand);
  transition: transform 0.3s ease;
  flex-shrink: 0;
}

.info-card.expanded .card-toggle {
  transform: rotate(45deg);
}

.info-card-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, padding 0.4s ease;
  padding: 0 1.25rem;
}

.info-card.expanded .info-card-content {
  max-height: 2000px;
  padding: 0 1.25rem 1.25rem 1.25rem;
}

.info-card-content p {
  margin: 0 0 0.75rem 0;
  line-height: 1.6;
  color: var(--text);
}

.info-card-content p:last-child {
  margin-bottom: 0;
}

/* Finisher's Gear CTA Card - Special Styling */
.info-card-cta {
  background: white;
  border: 2px solid var(--brand, #f10000);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: pointer;
  box-shadow: 0 6px 20px rgba(241, 0, 0, 0.15);
  text-decoration: none;
  display: block;
  position: relative;
  grid-column: 1 / -1;
}

.info-card-cta::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(241, 0, 0, 0.03) 0%, transparent 100%);
  pointer-events: none;
}

.info-card-cta:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(241, 0, 0, 0.25);
  border-width: 3px;
}

.info-card-cta .info-card-header {
  background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
  padding: 1.25rem;
  user-select: none;
}

.info-card-content-cta {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease, padding 0.4s ease;
  padding: 0 1.25rem;
}

.info-card-content-cta p {
  margin: 0 0 0.75rem 0;
  line-height: 1.6;
  color: var(--text);
}

.info-card-content-cta p:last-child {
  margin-bottom: 0;
}

.info-card-content ul {
  margin: 0;
  padding-left: 1.25rem;
  line-height: 1.8;
}

.info-card-content li {
  margin-bottom: 0.5rem;
}

.info-card-content a {
  color: var(--brand);
  text-decoration: underline;
}

.info-card-content a:hover {
  text-decoration: none;
}

/* Accordion Section Headers */
.route-section {
  margin: 3rem 0 1.5rem 0;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f8f8f8 0%, #fff 100%);
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.route-section h2 {
  margin: 0;
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

/* Accordion Container */
.route-accordion {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin: 1.5rem 0 3rem 0;
}

/* Accordion Item */
.route-item {
  border: 2px solid #ddd;
  border-radius: 12px;
  background: white;
  overflow: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.route-item:hover {
  box-shadow: 0 6px 16px rgba(0,0,0,0.15);
  border-color: var(--brand);
  transform: translateY(-2px);
}

.route-item.active {
  border-color: var(--brand);
  box-shadow: 0 8px 24px rgba(241,0,0,0.2);
}

/* Accordion Header */
.route-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem;
  cursor: pointer;
  user-select: none;
  gap: 1rem;
  flex-wrap: wrap;
  background: linear-gradient(135deg, #fafafa 0%, #fff 100%);
  transition: all 0.3s ease;
  position: relative;
}

.route-header:hover {
  background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
}

.route-item.active .route-header {
  background: linear-gradient(135deg, #fff0f0 0%, #fff 100%);
}

/* Close X button - only show when route is active */
.route-item.active .route-header::after {
  content: '‚úï';
  position: absolute;
  top: 1rem;
  right: 1rem;
  font-size: 1.5rem;
  color: var(--brand, #f10000);
  font-weight: 700;
  line-height: 1;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.route-item.active .route-header:hover::after {
  opacity: 1;
}

.route-title-section {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
  min-width: 200px;
}

.route-icon {
  font-size: 1.5rem;
  transition: transform 0.3s ease;
  color: var(--brand);
}

.route-item.active .route-icon {
  transform: rotate(90deg);
}

.route-title {
  font-weight: 700;
  font-size: 1.15rem;
  color: var(--text);
  line-height: 1.3;
}

.route-stats-inline {
  display: flex;
  gap: 1rem;
  color: var(--muted);
  font-size: 0.95rem;
  font-weight: 500;
  flex-wrap: wrap;
  align-items: center;
}

.route-stats-inline span {
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.difficulty-badge {
  display: inline-block;
  padding: 0.35rem 0.8rem;
  border-radius: 16px;
  font-size: 0.8rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: all 0.2s ease;
}

.difficulty-moderate {
  background: linear-gradient(135deg, #FFA726 0%, #FF9800 100%);
  color: white;
  border: 2px solid #FF9800;
}

.difficulty-hard {
  background: linear-gradient(135deg, #EF5350 0%, #E53935 100%);
  color: white;
  border: 2px solid #E53935;
}

.difficulty-very-hard {
  background: linear-gradient(135deg, #C62828 0%, #B71C1C 100%);
  color: white;
  border: 2px solid #B71C1C;
}

.route-actions {
  display: flex;
  gap: 0.5rem;
}

.gpx-download {
  padding: 0.6rem 1rem;
  background: linear-gradient(135deg, #f5f5f5 0%, #fff 100%);
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text);
  text-decoration: none;
  transition: all 0.3s ease;
  white-space: nowrap;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.gpx-download:hover {
  background: var(--brand);
  color: white;
  border-color: var(--brand);
  text-decoration: none;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(241,0,0,0.3);
}

/* Accordion Content */
.route-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.route-item.active .route-content {
  max-height: 2000px;
}

.route-content-inner {
  padding: 0 1.25rem 1.25rem 1.25rem;
}

.route-description {
  margin: 0 0 1.5rem 0;
  padding: 1rem;
  background: #f9f9f9;
  border-left: 3px solid var(--brand);
  border-radius: 4px;
  font-style: italic;
  color: var(--muted);
}

/* Map and Elevation Containers */
.route-map {
  height: 500px;
  width: 100%;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  border: 1px solid #eee;
  overflow: hidden;
  background: #aad3df;
}

.route-map .leaflet-tile-container {
  opacity: 1 !important;
}

.route-map .leaflet-tile,
.route-map .leaflet-tile-pane img,
.route-map img.leaflet-tile {
  opacity: 1 !important;
  visibility: visible !important;
  width: 256px !important;
  height: 256px !important;
  max-width: 256px !important;
  max-height: 256px !important;
  min-width: 256px !important;
  min-height: 256px !important;
}

.route-map .leaflet-layer {
  opacity: 1 !important;
}

.route-map img {
  max-width: none !important;
  width: auto !important;
  height: auto !important;
}

.route-map .leaflet-overlay-pane {
  z-index: 400 !important;
  pointer-events: none !important;
}

.route-map .leaflet-overlay-pane svg,
.route-map svg.leaflet-zoom-animated {
  overflow: visible !important;
  max-width: none !important;
  max-height: none !important;
  min-width: 0 !important;
  min-height: 0 !important;
  display: block !important;
  position: absolute !important;
}

/* Critical: Override main.css rule that forces height:auto on all SVGs */
main .container .prose .route-map svg,
.route-map .leaflet-overlay-pane svg,
.route-map svg {
  max-width: none !important;
  max-height: none !important;
  height: initial !important;
  width: initial !important;
}

.route-map .leaflet-overlay-pane path,
.route-map path.leaflet-interactive,
.route-map svg path,
.route-map path.route-polyline {
  visibility: visible !important;
  display: block !important;
  opacity: 0.8 !important;
  stroke: #f10000 !important;
  stroke-width: 3px !important;
  stroke-opacity: 0.8 !important;
  fill: none !important;
  fill-opacity: 0 !important;
  pointer-events: auto !important;
  vector-effect: non-scaling-stroke !important;
  stroke-linecap: round !important;
  stroke-linejoin: round !important;
  transform: none !important;
}

path.route-polyline {
  stroke: #f10000 !important;
  stroke-width: 3px !important;
  visibility: visible !important;
  opacity: 0.8 !important;
}

.route-map .leaflet-marker-icon,
.route-map .leaflet-marker-pane img {
  max-width: none !important;
  min-width: 25px !important;
  min-height: 41px !important;
  width: 25px !important;
  height: 41px !important;
}

.route-map .leaflet-marker-shadow {
  max-width: none !important;
  width: 41px !important;
  height: 41px !important;
}

.route-map .custom-marker {
  width: 30px !important;
  height: 30px !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

.route-map .custom-marker div {
  width: 30px !important;
  height: 30px !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

.elevation-profile {
  height: 300px;
  width: 100%;
  background: white;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid #eee;
}

.elevation-profile canvas {
  max-width: 100% !important;
}

/* Coming Soon Placeholder */
.coming-soon {
  padding: 2rem;
  text-align: center;
  background: #f9f9f9;
  border-radius: 8px;
  color: var(--muted);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .route-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .route-stats-inline {
    font-size: 0.85rem;
  }

  .route-map {
    height: 400px;
  }

  .elevation-profile {
    height: 250px;
  }
}
</style>

<!-- ROUTES 2-COLUMN LAYOUT -->
<div class="routes-2col-wrapper">

<!-- LEFT COLUMN: NORTH ROUTES -->
<div class="routes-column">

<div class="route-section">
<h2 class="route-direction-header">North Routes ‚Äì Andratx ‚Üí Pollen√ßa</h2>
</div>

<div class="route-accordion">
  <!-- Route 1: Vanilla -->
  <div class="route-item" id="route-north-1">
    <div class="route-header" onclick="toggleRoute('north-1')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Vanilla ‚Äì Port d'Andratx ‚Üí Port de Pollen√ßa</div>
          <div class="route-stats-inline">
            <span>üìè 115 km</span>
            <span>‚õ∞Ô∏è 2,425 m</span>
            <span class="difficulty-badge difficulty-moderate">Moderate</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portandratx-pollenca-vanilla.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Direct classic: SW coastal section ‚Üí S√≥ller ‚Üí Puig Major ‚Üí aqueduct ‚Üí Lluc ‚Üí fast descent into Pollen√ßa. Most direct return route.</p>
        <div id="map-north-1" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-north-1"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 2: Via Caimari -->
  <div class="route-item" id="route-north-2">
    <div class="route-header" onclick="toggleRoute('north-2')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Via Caimari (Vanilla+)</div>
          <div class="route-stats-inline">
            <span>üìè 137 km</span>
            <span>‚õ∞Ô∏è 2,700 m</span>
            <span class="difficulty-badge difficulty-moderate">Moderate</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portandratx-pollenca-via-caimari.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">As above, but continue past the Repsol at Lluc, descend Coll de sa Bataia ‚Üí lanes via Binibona/Campanet ‚Üí Alc√∫dia bay road ‚Üí Port de Pollen√ßa. Second most direct return route. Additional lanes before the finish.</p>
        <div id="map-north-2" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-north-2"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 3: Port Valldemossa -->
  <div class="route-item" id="route-north-3">
    <div class="route-header" onclick="toggleRoute('north-3')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Incl. Port Valldemossa</div>
          <div class="route-stats-inline">
            <span>üìè 132 km</span>
            <span>‚õ∞Ô∏è 3,000 m</span>
            <span class="difficulty-badge difficulty-hard">Hard</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portandratx-pollenca-portvalldemossa.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Coastal section + drop/return Port Valldemossa ‚Üí S√≥ller ‚Üí Puig Major ‚Üí Lluc ‚Üí descend to Pollen√ßa. Great addition to the vanilla route.</p>
        <div id="map-north-3" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-north-3"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 4: Valldemossa & Sa Calobra -->
  <div class="route-item" id="route-north-4">
    <div class="route-header" onclick="toggleRoute('north-4')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Incl. Port Valldemossa & Sa Calobra</div>
          <div class="route-stats-inline">
            <span>üìè 158 km</span>
            <span>‚õ∞Ô∏è 3,949 m</span>
            <span class="difficulty-badge difficulty-hard">Hard</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portandratx-pollenca-valldemossa-sacalobra.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Coastal section + Port Valldemossa, then Puig Major ‚Üí left at aqueduct ‚Üí Coll dels Reis ‚Üí down Sa Calobra, climb back ‚Üí Lluc ‚Üí descend to Pollen√ßa. Hard.</p>
        <div id="map-north-4" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-north-4"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 5: Big Daddy -->
  <div class="route-item" id="route-north-5">
    <div class="route-header" onclick="toggleRoute('north-5')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Big Daddy Challenge (8 classified cols)</div>
          <div class="route-stats-inline">
            <span>üìè 162 km</span>
            <span>‚õ∞Ô∏è 4,267 m</span>
            <span class="difficulty-badge difficulty-very-hard">Very Hard</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portandratx-pollenca-big-daddy.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Coastal section + Port des Canonge + Port Valldemossa ‚Üí long side Puig Major ‚Üí aqueduct ‚Üí Coll dels Reis ‚Üí Sa Calobra (down & up) ‚Üí Lluc ‚Üí Pollen√ßa/Port. Very hard.</p>
        <div id="map-north-5" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-north-5"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Placeholder: North Route 6 - Coming Soon -->
  <div class="route-item" id="route-north-6">
    <div class="route-header">
      <div class="route-title-section">
        <span style="font-size: 1.5rem;">üîÑ</span>
        <div>
          <div class="route-title">Additional Route Coming Soon</div>
          <div class="route-stats-inline">
            <span style="color: var(--muted);">Details to be announced</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</div>

<!-- RIGHT COLUMN: SOUTH ROUTES -->
<div class="routes-column">

<div class="route-section">
<h2 class="route-direction-header">South Routes ‚Äì Pollen√ßa ‚Üí Andratx</h2>
</div>

<div class="route-accordion">
  <!-- Route 6: South Vanilla -->
  <div class="route-item" id="route-south-1">
    <div class="route-header" onclick="toggleRoute('south-1')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Vanilla ‚Äì Port de Pollen√ßa ‚Üí Port d'Andratx</div>
          <div class="route-stats-inline">
            <span>üìè 121 km</span>
            <span>‚õ∞Ô∏è 2,700 m</span>
            <span class="difficulty-badge difficulty-moderate">Moderate</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portpollenca-portandratx-vanilla.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Coll de Femenia ‚Üí past Lluc/Sa Calobra turn ‚Üí easy side Puig Major ‚Üí 14 km descent to S√≥ller ‚Üí coast via Dei√†, Valldemossa, Banyalbufar, Estellencs ‚Üí Port d'Andratx. Most direct return route. Brilliant!</p>
        <div id="map-south-1" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-south-1"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 7: Canonge & Valldemossa -->
  <div class="route-item" id="route-south-2">
    <div class="route-header" onclick="toggleRoute('south-2')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Incl. Port des Canonge & Port Valldemossa</div>
          <div class="route-stats-inline">
            <span>üìè 145 km</span>
            <span>‚õ∞Ô∏è 3,390 m</span>
            <span class="difficulty-badge difficulty-hard">Hard</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portpollenca-portandratx-canonge-valldemossa.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Femenia ‚Üí Lluc ‚Üí Puig Major ‚Üí S√≥ller ‚Üí coast + add-ons: drop/return Port des Canonge and Port Valldemossa ‚Üí SW coastal finish to Andratx.</p>
        <div id="map-south-2" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-south-2"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 8: Via Puigpunyent -->
  <div class="route-item" id="route-south-3">
    <div class="route-header" onclick="toggleRoute('south-3')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Via Puigpunyent</div>
          <div class="route-stats-inline">
            <span>üìè 125 km</span>
            <span>‚õ∞Ô∏è 2,650 m</span>
            <span class="difficulty-badge difficulty-moderate">Moderate</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portpollenca-portandratx-puigpunyent.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">Femenia ‚Üí Lluc ‚Üí Puig Major ‚Üí S√≥ller ‚Üí Dei√† ‚Üí Valldemossa ‚Üí Esporles ‚Üí Puigpunyent ‚Üí Galilea ‚Üí Es Capdell√† ‚Üí Port d'Andratx. Spend a little time away from the coast and off the grid!</p>
        <div id="map-south-3" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-south-3"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Route 9: Big Daddy Reverse -->
  <div class="route-item" id="route-south-4">
    <div class="route-header" onclick="toggleRoute('south-4')">
      <div class="route-title-section">
        <span class="route-icon">‚ñ∂</span>
        <div>
          <div class="route-title">Big Daddy Challenge (reverse)</div>
          <div class="route-stats-inline">
            <span>üìè 167 km</span>
            <span>‚õ∞Ô∏è 4,121 m</span>
            <span class="difficulty-badge difficulty-very-hard">Very Hard</span>
          </div>
        </div>
      </div>
      <div class="route-actions">
        <a href="/routes/portpollenca-portandratx-big-daddy.gpx" download class="gpx-download" onclick="event.stopPropagation()">‚¨á GPX</a>
      </div>
    </div>
    <div class="route-content">
      <div class="route-content-inner">
        <p class="route-description">As above conceptually, including the three "ports" (Canonge, Valldemossa, Sa Calobra). For strong climbers only.</p>
        <div id="map-south-4" class="route-map"></div>
        <div class="elevation-profile">
          <canvas id="chart-south-4"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Placeholder: South Route 5 - Coming Soon -->
  <div class="route-item" id="route-south-5">
    <div class="route-header">
      <div class="route-title-section">
        <span style="font-size: 1.5rem;">üîÑ</span>
        <div>
          <div class="route-title">Additional Route Coming Soon</div>
          <div class="route-stats-inline">
            <span style="color: var(--muted);">Details to be announced</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Placeholder: South Route 6 - Coming Soon -->
  <div class="route-item" id="route-south-6">
    <div class="route-header">
      <div class="route-title-section">
        <span style="font-size: 1.5rem;">üîÑ</span>
        <div>
          <div class="route-title">Additional Route Coming Soon</div>
          <div class="route-stats-inline">
            <span style="color: var(--muted);">Details to be announced</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</div>

</div>

<script>
// Toggle info card expansion
function toggleCard(card) {
  const wasExpanded = card.classList.contains('expanded');
  const grid = card.closest('.info-cards-grid');

  // Close all other cards
  document.querySelectorAll('.info-card.expanded').forEach(c => {
    c.classList.remove('expanded');
  });

  // Toggle this card
  if (!wasExpanded) {
    card.classList.add('expanded');
    grid.classList.add('has-expanded');
  } else {
    grid.classList.remove('has-expanded');
  }
}

// Smooth scroll to product panel (CTA card click)
function smoothScrollToProduct(event) {
  // Prevent any default behavior
  if (event) {
    event.stopPropagation();
  }

  const target = document.getElementById('finishers-gear');
  if (target) {
    target.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// Route configuration
// Using -web.gpx files for display (75% smaller), original files for downloads
const routes = {
  'north-1': { gpx: 'portandratx-pollenca-vanilla-web.gpx', startName: 'Port d\'Andratx', endName: 'Port de Pollen√ßa' },
  'north-2': { gpx: 'portandratx-pollenca-via-caimari-web.gpx', startName: 'Port d\'Andratx', endName: 'Port de Pollen√ßa' },
  'north-3': { gpx: 'portandratx-pollenca-portvalldemossa-web.gpx', startName: 'Port d\'Andratx', endName: 'Port de Pollen√ßa' },
  'north-4': { gpx: 'portandratx-pollenca-valldemossa-sacalobra-web.gpx', startName: 'Port d\'Andratx', endName: 'Port de Pollen√ßa' },
  'north-5': { gpx: 'portandratx-pollenca-big-daddy-web.gpx', startName: 'Port d\'Andratx', endName: 'Port de Pollen√ßa' },
  'south-1': { gpx: 'portpollenca-portandratx-vanilla-web.gpx', startName: 'Port de Pollen√ßa', endName: 'Port d\'Andratx' },
  'south-2': { gpx: 'portpollenca-portandratx-canonge-valldemossa-web.gpx', startName: 'Port de Pollen√ßa', endName: 'Port d\'Andratx' },
  'south-3': { gpx: 'portpollenca-portandratx-puigpunyent-web.gpx', startName: 'Port de Pollen√ßa', endName: 'Port d\'Andratx' },
  'south-4': { gpx: 'portpollenca-portandratx-big-daddy-web.gpx', startName: 'Port de Pollen√ßa', endName: 'Port d\'Andratx' }
};

const loadedRoutes = {};

// Toggle accordion item
function toggleRoute(routeId) {
  const item = document.getElementById('route-' + routeId);
  const wasActive = item.classList.contains('active');
  const wrapper = document.querySelector('.routes-2col-wrapper');

  // Close all other items
  document.querySelectorAll('.route-item').forEach(el => {
    el.classList.remove('active');
  });

  // Open this item if it wasn't active
  if (!wasActive) {
    item.classList.add('active');
    wrapper.classList.add('has-expanded');

    // Load route if not already loaded
    if (!loadedRoutes[routeId]) {
      loadRoute(routeId);
      loadedRoutes[routeId] = true;
    }
  } else {
    wrapper.classList.remove('has-expanded');
  }
}

// Load and render a route
async function loadRoute(routeId) {
  const config = routes[routeId];
  if (!config) return;

  try {
    // Fetch GPX
    const response = await fetch('/routes/' + config.gpx);
    const gpxText = await response.text();
    const parser = new DOMParser();
    const gpxDoc = parser.parseFromString(gpxText, 'text/xml');

    // Extract coordinates
    const trkpts = Array.from(gpxDoc.querySelectorAll('trkpt'));
    const coordinates = trkpts.map(pt => ({
      lat: parseFloat(pt.getAttribute('lat')),
      lon: parseFloat(pt.getAttribute('lon')),
      ele: parseFloat(pt.querySelector('ele').textContent)
    }));

    // Render map
    renderMap(routeId, coordinates, config);

    // Render elevation chart
    renderElevationChart(routeId, coordinates);

  } catch (error) {
    console.error('Error loading route:', error);
  }
}

// Render map
function renderMap(routeId, coordinates, config) {
  const mapId = 'map-' + routeId;
  const mapDiv = document.getElementById(mapId);

  console.log('Rendering map for', routeId);
  console.log('Map div dimensions:', mapDiv.offsetWidth, 'x', mapDiv.offsetHeight);

  // Initialize map
  const map = L.map(mapId).setView([coordinates[0].lat, coordinates[0].lon], 10);
  console.log('Map initialized');

  // Add tiles
  const tileLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 19
  });

  tileLayer.on('tileload', function() {
    console.log('Tile loaded for', routeId);
  });

  tileLayer.on('tileerror', function(error) {
    console.error('Tile error for', routeId, error);
  });

  tileLayer.addTo(map);
  console.log('Tiles added');

  // Add route line with explicit stroke properties
  const routeLine = L.polyline(coordinates.map(c => [c.lat, c.lon]), {
    color: '#f10000',
    weight: 3,
    opacity: 0.8,
    fillOpacity: 0,
    lineCap: 'round',
    lineJoin: 'round',
    className: 'route-polyline',
    smoothFactor: 0,  // Disable path simplification
    noClip: true      // Don't clip the path
  }).addTo(map);

  // Explicitly bring polyline to front
  routeLine.bringToFront();

  console.log('Route line added with', coordinates.length, 'points');
  console.log('Route line bounds:', routeLine.getBounds());

  // Check the actual DOM element
  setTimeout(() => {
    const pathElement = routeLine.getElement();
    if (pathElement) {
      console.log('Route line DOM element found');
      console.log('Path element tag:', pathElement.tagName);
      console.log('Path element class:', pathElement.className);
      console.log('Path computed stroke:', window.getComputedStyle(pathElement).stroke);
      console.log('Path computed stroke-width:', window.getComputedStyle(pathElement).strokeWidth);
      console.log('Path computed display:', window.getComputedStyle(pathElement).display);
      console.log('Path computed visibility:', window.getComputedStyle(pathElement).visibility);
    } else {
      console.error('Route line DOM element NOT found!');
    }
  }, 500);

  // Create custom marker icons with inline SVG
  const startIcon = L.divIcon({
    html: '<div style="width:30px;height:30px;background:#00ff00;border:3px solid white;border-radius:50%;box-shadow:0 2px 5px rgba(0,0,0,0.3);"></div>',
    className: 'custom-marker',
    iconSize: [30, 30],
    iconAnchor: [15, 15]
  });

  const endIcon = L.divIcon({
    html: '<div style="width:30px;height:30px;background:#ff0000;border:3px solid white;border-radius:50%;box-shadow:0 2px 5px rgba(0,0,0,0.3);"></div>',
    className: 'custom-marker',
    iconSize: [30, 30],
    iconAnchor: [15, 15]
  });

  // Add markers with custom icons
  L.marker([coordinates[0].lat, coordinates[0].lon], { icon: startIcon })
    .addTo(map)
    .bindPopup('<strong>Start:</strong> ' + config.startName);
  console.log('Start marker added');

  const lastIdx = coordinates.length - 1;
  L.marker([coordinates[lastIdx].lat, coordinates[lastIdx].lon], { icon: endIcon })
    .addTo(map)
    .bindPopup('<strong>End:</strong> ' + config.endName);
  console.log('End marker added');

  // Fit bounds
  map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
  console.log('Bounds fitted');

  // Force resize after animation
  setTimeout(() => {
    map.invalidateSize();
    console.log('Map invalidated for', routeId, 'new dimensions:', mapDiv.offsetWidth, 'x', mapDiv.offsetHeight);

    // Debug: Check tile visibility
    const tiles = mapDiv.querySelectorAll('.leaflet-tile');
    console.log('Number of tiles in DOM:', tiles.length);
    if (tiles.length > 0) {
      console.log('First tile dimensions:', tiles[0].offsetWidth, 'x', tiles[0].offsetHeight);
      console.log('First tile computed style:', window.getComputedStyle(tiles[0]).width, window.getComputedStyle(tiles[0]).height);
    }

    // Debug: Check route visibility
    const overlayPane = mapDiv.querySelector('.leaflet-overlay-pane');
    console.log('Overlay pane:', overlayPane ? 'found' : 'NOT FOUND');

    if (overlayPane) {
      const svgs = overlayPane.querySelectorAll('svg');
      console.log('SVGs in overlay:', svgs.length);
      if (svgs.length > 0) {
        const svg = svgs[0];
        console.log('SVG dimensions:', svg.getAttribute('width'), 'x', svg.getAttribute('height'));
        console.log('SVG style:', svg.style.cssText);
        console.log('SVG position:', window.getComputedStyle(svg).position);
      }
    }

    const paths = mapDiv.querySelectorAll('path');
    console.log('Number of path elements:', paths.length);
    if (paths.length > 0) {
      const pathStyle = window.getComputedStyle(paths[0]);
      console.log('Path stroke:', pathStyle.stroke, 'stroke-width:', pathStyle.strokeWidth, 'visibility:', pathStyle.visibility);
      console.log('Path d attribute length:', paths[0].getAttribute('d') ? paths[0].getAttribute('d').length : 0);

      // Check path bounding box
      try {
        const bbox = paths[0].getBBox();
        console.log('Path bbox:', bbox.x, bbox.y, bbox.width, bbox.height);

        // Check if bbox is outside visible area
        const svg = paths[0].closest('svg');
        const svgRect = svg.getBoundingClientRect();
        const pathRect = paths[0].getBoundingClientRect();
        console.log('SVG screen position:', svgRect.x, svgRect.y, svgRect.width, svgRect.height);
        console.log('Path screen position:', pathRect.x, pathRect.y, pathRect.width, pathRect.height);
        console.log('SVG viewBox:', svg.getAttribute('viewBox'));
        console.log('SVG transform:', svg.style.transform);

        // Sample first few path coordinates
        const dAttr = paths[0].getAttribute('d');
        const firstCoords = dAttr.substring(0, 200);
        console.log('First 200 chars of path d:', firstCoords);
      } catch(e) {
        console.log('Could not get bbox:', e.message);
      }
    }

    // Debug: Check markers
    const markers = mapDiv.querySelectorAll('.leaflet-marker-icon');
    console.log('Number of markers:', markers.length);
    if (markers.length > 0) {
      console.log('First marker dimensions:', markers[0].offsetWidth, 'x', markers[0].offsetHeight);
    }
  }, 1000);
}

// Render elevation chart
function renderElevationChart(routeId, coordinates) {
  const chartId = 'chart-' + routeId;
  const ctx = document.getElementById(chartId).getContext('2d');

  // Calculate cumulative distance
  const distancePoints = [0];
  for (let i = 1; i < coordinates.length; i++) {
    const lat1 = coordinates[i-1].lat * Math.PI / 180;
    const lat2 = coordinates[i].lat * Math.PI / 180;
    const dLat = (coordinates[i].lat - coordinates[i-1].lat) * Math.PI / 180;
    const dLon = (coordinates[i].lon - coordinates[i-1].lon) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1) * Math.cos(lat2) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    distancePoints.push(distancePoints[i-1] + 6371 * c);
  }

  // Sample data
  const sampleRate = 10;
  const sampledDistances = distancePoints.filter((_, i) => i % sampleRate === 0);
  const sampledElevations = coordinates.filter((_, i) => i % sampleRate === 0).map(c => c.ele);

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: sampledDistances.map(d => d.toFixed(1)),
      datasets: [{
        label: 'Elevation (m)',
        data: sampledElevations,
        borderColor: '#f10000',
        backgroundColor: 'rgba(241, 0, 0, 0.1)',
        borderWidth: 2,
        fill: true,
        tension: 0.4,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            title: (context) => 'Distance: ' + context[0].label + ' km',
            label: (context) => 'Elevation: ' + context.parsed.y.toFixed(0) + ' m'
          }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'Distance (km)' },
          ticks: { maxTicksLimit: 15 }
        },
        y: {
          title: { display: true, text: 'Elevation (m)' }
        }
      },
      interaction: {
        intersect: false,
        mode: 'index'
      }
    }
  });
}

</script>

<!-- Custom Product Panel -->
<div id="finishers-gear" class="custom-product-panel" style="margin: 4rem auto 2rem; padding: 0.9rem 2rem 1.5rem 2rem; max-width: 800px; border-radius: 1rem; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); scroll-margin-top: 2rem;">

  <div style="text-align: center; margin-bottom: 3rem;">
    <h2 style="color: var(--brand, #f10000); margin-bottom: 0.5rem; font-size: 2rem; font-weight: 700;">Commemorate Your Ride</h2>
    <p style="color: #666; font-size: 1.1rem;">Celebrate completing the epic Andratx to Pollen√ßa route with our exclusive finisher's t-shirt!</p>
  </div>

  <div id="custom-product-card" style="display: flex; gap: 2rem; align-items: flex-start; flex-wrap: wrap; justify-content: center;">
    <!-- Product will be loaded here by JavaScript -->
    <div style="text-align: center; width: 100%; padding: 2rem; color: #999;">
      <div style="font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
      Loading product...
    </div>
  </div>

</div>

<style>
.custom-product-image {
  flex: 1;
  min-width: 300px;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  background: white;
  padding: 1.5rem;
  border-radius: 0.75rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.custom-product-image #product-main-image {
  max-width: 100%;
  width: 100%;
  height: auto;
  border-radius: 0.5rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease, opacity 0.15s ease;
  object-fit: contain;
}

.custom-product-image #product-main-image:hover {
  transform: scale(1.02);
}

.custom-product-thumbnails {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
  justify-content: center;
  flex-wrap: wrap;
}

.custom-thumbnail {
  width: 60px;
  height: 60px;
  border-radius: 0.375rem;
  cursor: pointer;
  border: 2px solid #e0e0e0;
  transition: all 0.3s ease;
  object-fit: cover;
}

.custom-thumbnail:hover {
  border-color: var(--brand, #f10000);
  transform: scale(1.05);
}

.custom-thumbnail.active {
  border-color: var(--brand, #f10000);
  border-width: 3px;
  box-shadow: 0 0 0 2px rgba(241, 0, 0, 0.2);
}

.custom-product-details {
  flex: 1;
  min-width: 300px;
}

.custom-product-name {
  font-size: 1.5rem;
  font-weight: 700;
  color: #333;
  margin-bottom: 1rem;
}

.custom-product-price {
  font-size: 2rem;
  font-weight: 700;
  color: var(--brand, #f10000);
  margin-bottom: 1rem;
}

.custom-product-description {
  color: #666;
  line-height: 1.6;
  margin-bottom: 1rem;
  font-size: 1rem;
  max-height: 150px;
  overflow: hidden;
  transition: max-height 0.4s ease;
  position: relative;
}

.custom-product-description.expanded {
  max-height: none;
}

.custom-product-description:not(.expanded)::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 50px;
  background: linear-gradient(to bottom, transparent, white);
}

.description-toggle {
  color: var(--brand, #f10000);
  font-weight: 600;
  cursor: pointer;
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
  display: inline-block;
  transition: opacity 0.3s ease;
}

.description-toggle:hover {
  opacity: 0.8;
  text-decoration: underline;
}

.custom-product-options {
  margin-bottom: 1.5rem;
}

.custom-product-options label {
  display: block;
  font-weight: 600;
  color: #333;
  margin-bottom: 0.5rem;
  font-size: 0.95rem;
}

.custom-product-options select {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid #e0e0e0;
  border-radius: 0.5rem;
  font-size: 1rem;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
}

.custom-product-options select:hover {
  border-color: var(--brand, #f10000);
}

.custom-product-options select:focus {
  outline: none;
  border-color: var(--brand, #f10000);
  box-shadow: 0 0 0 3px rgba(241, 0, 0, 0.1);
}

.custom-add-to-cart {
  width: 100%;
  padding: 1rem 2rem;
  background: linear-gradient(135deg, var(--brand, #f10000) 0%, #ff3333 100%);
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 6px 20px rgba(241, 0, 0, 0.4);
  position: relative;
  overflow: hidden;
}

.custom-add-to-cart::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transition: left 0.6s ease;
}

.custom-add-to-cart:hover::before {
  left: 100%;
}

.custom-add-to-cart:hover {
  transform: scale(1.05) translateY(-2px);
  box-shadow: 0 10px 30px rgba(241, 0, 0, 0.6);
}

.custom-add-to-cart:active {
  transform: scale(0.98) translateY(0);
}

@media (max-width: 768px) {
  .custom-product-image {
    max-width: 100%;
  }

  #custom-product-card {
    gap: 1.5rem;
  }
}

/* Route Direction Headers - Left & Right Border Accent */
.route-direction-header {
  font-size: 1.8rem;
  font-weight: 700;
  padding: 1.25rem 1.5rem;
  margin: 3rem 0 2rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-left: 5px solid var(--brand, #f10000);
  border-right: 5px solid var(--brand, #f10000);
  border-radius: 0.5rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  color: #333;
}

.route-direction-header:hover {
  border-left-width: 8px;
  border-right-width: 8px;
  transition: all 0.3s ease;
}

/* Shuttle Navigation Sidebar Styles */
.shuttle-nav-mobile {
  display: none; /* Hidden on desktop */
  background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-radius: 1rem;
  margin-bottom: 2rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.shuttle-nav-mobile-header {
  padding: 1.5rem;
  background: white;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: background 0.3s ease;
}

.shuttle-nav-mobile-header:hover {
  background: #f8f9fa;
}

.shuttle-nav-mobile-header h3 {
  margin: 0;
  font-size: 1.3rem;
  color: #333;
}

.shuttle-nav-toggle {
  font-size: 2rem;
  color: var(--brand, #f10000);
  font-weight: 300;
  transition: transform 0.3s ease;
}

.shuttle-nav-mobile-header.active .shuttle-nav-toggle {
  transform: rotate(45deg);
}

.shuttle-nav-mobile-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.shuttle-nav-mobile-content.active {
  max-height: 2000px;
  padding: 1.5rem;
}

.content-with-sidebar {
  display: flex;
  gap: 2rem;
  align-items: flex-start;
}

.main-content {
  flex: 1;
  min-width: 0; /* Prevents flex overflow */
}

.shuttle-nav-sidebar {
  width: 350px;
  flex-shrink: 0;
  position: sticky;
  top: 100px; /* Accounts for sticky header */
  background: white;
  border-radius: 1rem;
  padding: 2rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  max-height: calc(100vh - 120px);
  overflow-y: auto;
}

.shuttle-nav-sidebar h3 {
  margin: 0 0 1.5rem 0;
  font-size: 1.4rem;
  color: #333;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.shuttle-nav-category {
  margin-bottom: 1.5rem;
}

.shuttle-nav-category-title {
  font-weight: 700;
  color: var(--brand, #f10000);
  margin-bottom: 0.75rem;
  font-size: 1.1rem;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem;
  border-radius: 0.5rem;
  transition: background 0.3s ease;
}

.shuttle-nav-category-title:hover {
  background: #f8f9fa;
}

.shuttle-nav-subcategory {
  margin-left: 1rem;
  border-left: 2px solid #e0e0e0;
  padding-left: 1rem;
}

.shuttle-nav-link {
  display: block;
  padding: 0.6rem 0.8rem;
  color: #666;
  text-decoration: none;
  border-radius: 0.5rem;
  margin-bottom: 0.5rem;
  transition: all 0.3s ease;
  font-size: 0.95rem;
}

.shuttle-nav-link:hover {
  background: #f8f9fa;
  color: var(--brand, #f10000);
  transform: translateX(4px);
}

.shuttle-nav-loading {
  text-align: center;
  padding: 2rem;
  color: #999;
}

@media (max-width: 1024px) {
  .shuttle-nav-mobile {
    display: block;
  }

  .shuttle-nav-sidebar {
    display: none;
  }

  .content-with-sidebar {
    display: block;
  }
}
</style>

  </div> <!-- Close main-content -->

  <!-- SHUTTLE NAVIGATION SIDEBAR (Desktop only) -->
  <aside class="shuttle-nav-sidebar">
    <h3>üöå Book Your Shuttle</h3>
    <div id="shuttle-nav-sidebar-content">
      <div class="shuttle-nav-loading">Loading shuttle schedules...</div>
    </div>
  </aside>

</div> <!-- Close content-with-sidebar -->

<script>
// Load Ecwid cart script first
if (!window.Ecwid) {
  const ecwidScript = document.createElement('script');
  ecwidScript.src = 'https://app.ecwid.com/script.js?5889081';
  ecwidScript.charset = 'utf-8';
  ecwidScript.async = true;
  document.head.appendChild(ecwidScript);
}

// Fetch and display custom product
async function loadCustomProduct() {
  const storeId = '5889081';
  const productId = '788401800';
  const token = 'public_eWe1rYbgpSHJ5tFvV5BhkWEWkLmciF2i';

  try {
    const response = await fetch(`https://app.ecwid.com/api/v3/${storeId}/products/${productId}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    const product = await response.json();

    // Build product HTML
    let optionsHTML = '';
    if (product.options && product.options.length > 0) {
      product.options.forEach(option => {
        optionsHTML += `
          <div class="custom-product-options">
            <label for="option-${option.name}">${option.name}:</label>
            <select id="option-${option.name}" data-option-name="${option.name}">
              ${option.choices.map(choice =>
                `<option value="${choice.text}" ${choice.priceModifier ? `data-price="${choice.priceModifier}"` : ''}>${choice.text}${choice.priceModifier ? ` (+‚Ç¨${choice.priceModifier.toFixed(2)})` : ''}</option>`
              ).join('')}
            </select>
          </div>
        `;
      });
    }

    // Build thumbnail gallery for color variations
    let thumbnailsHTML = '';
    const colorImages = new Map();
    if (product.combinations) {
      // Get unique color images
      product.combinations.forEach(combo => {
        const colorOption = combo.options.find(opt => opt.name === 'Color');
        if (colorOption && combo.thumbnailUrl && !colorImages.has(colorOption.value)) {
          colorImages.set(colorOption.value, {
            url: combo.originalImageUrl || combo.imageUrl,
            thumbnail: combo.thumbnailUrl,
            color: colorOption.value
          });
        }
      });

      if (colorImages.size > 0) {
        thumbnailsHTML = '<div class="custom-product-thumbnails">';
        let isFirst = true;
        colorImages.forEach((img, color) => {
          thumbnailsHTML += `<img
            src="${img.thumbnail}"
            class="custom-thumbnail ${isFirst ? 'active' : ''}"
            data-full-image="${img.url}"
            data-color="${color}"
            alt="${color}"
            onclick="changeProductImage('${img.url}', '${color}', this)"
          >`;
          isFirst = false;
        });
        thumbnailsHTML += '</div>';
      }
    }

    const productHTML = `
      <div class="custom-product-image">
        <img id="product-main-image" src="${product.imageUrl || product.thumbnailUrl}" alt="${product.name}">
        ${thumbnailsHTML}
      </div>
      <div class="custom-product-details">
        <h3 class="custom-product-name">${product.name}</h3>
        <div class="custom-product-price" id="product-price">‚Ç¨${product.defaultDisplayedPrice.toFixed(2)}</div>
        ${product.description ? `
          <div class="custom-product-description" id="product-description">${product.description}</div>
          <div class="description-toggle" id="description-toggle" onclick="toggleDescription()">Read More ‚Üì</div>
        ` : ''}
        ${optionsHTML}
        <button class="custom-add-to-cart" onclick="addToEcwidCart()">
          Add to Cart ‚Üí
        </button>
      </div>
    `;

    document.getElementById('custom-product-card').innerHTML = productHTML;

    // Store product data for cart function
    window.customProductData = {
      id: product.id,
      price: product.price,
      options: product.options || [],
      combinations: product.combinations || []
    };

    // Add event listener to color selector to change image and thumbnail state
    const colorSelect = document.getElementById('option-Color');
    if (colorSelect && product.combinations) {
      colorSelect.addEventListener('change', function() {
        const selectedColor = this.value;
        // Find a combination with this color
        const matchingCombination = product.combinations.find(combo =>
          combo.options.some(opt => opt.name === 'Color' && opt.value === selectedColor)
        );

        if (matchingCombination && matchingCombination.originalImageUrl) {
          const productImage = document.getElementById('product-main-image');
          productImage.style.opacity = '0.5';
          setTimeout(() => {
            productImage.src = matchingCombination.originalImageUrl;
            productImage.style.opacity = '1';
          }, 150);

          // Update active thumbnail
          updateActiveThumbnail(selectedColor);
        }
      });
    }

  } catch (error) {
    console.error('Error loading product:', error);
    document.getElementById('custom-product-card').innerHTML = `
      <div style="text-align: center; width: 100%; padding: 2rem; color: #999;">
        <p>Unable to load product. Please try again later.</p>
      </div>
    `;
  }
}

// Change main image when thumbnail is clicked
function changeProductImage(imageUrl, color, thumbnailElement) {
  const productImage = document.getElementById('product-main-image');

  // Fade transition
  productImage.style.opacity = '0.5';
  setTimeout(() => {
    productImage.src = imageUrl;
    productImage.style.opacity = '1';
  }, 150);

  // Update color dropdown
  const colorSelect = document.getElementById('option-Color');
  if (colorSelect) {
    colorSelect.value = color;
  }

  // Update active thumbnail
  updateActiveThumbnail(color);
}

// Update which thumbnail is marked as active
function updateActiveThumbnail(selectedColor) {
  const thumbnails = document.querySelectorAll('.custom-thumbnail');
  thumbnails.forEach(thumb => {
    if (thumb.dataset.color === selectedColor) {
      thumb.classList.add('active');
    } else {
      thumb.classList.remove('active');
    }
  });
}

// Add product to Ecwid cart
function addToEcwidCart() {
  if (!window.Ecwid || !window.customProductData) {
    alert('Loading cart system, please try again in a moment.');
    return;
  }

  // Gather selected options
  const selectedOptions = {};
  const optionSelects = document.querySelectorAll('[data-option-name]');
  optionSelects.forEach(select => {
    selectedOptions[select.dataset.optionName] = select.value;
  });

  // Add to cart via Ecwid
  Ecwid.Cart.addProduct({
    id: window.customProductData.id,
    quantity: 1,
    options: selectedOptions,
    callback: function(success) {
      if (success) {
        // Optional: Show success message
        const btn = document.querySelector('.custom-add-to-cart');
        const originalText = btn.innerHTML;
        btn.innerHTML = '‚úì Added to Cart!';
        btn.style.background = '#28a745';
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = '';
        }, 2000);
      }
    }
  });
}

// Toggle product description expand/collapse
function toggleDescription() {
  const description = document.getElementById('product-description');
  const toggle = document.getElementById('description-toggle');

  if (description.classList.contains('expanded')) {
    description.classList.remove('expanded');
    toggle.textContent = 'Read More ‚Üì';
  } else {
    description.classList.add('expanded');
    toggle.textContent = 'Show Less ‚Üë';
  }
}

// Load product when page is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', loadCustomProduct);
} else {
  loadCustomProduct();
}

// Toggle mobile shuttle navigation
function toggleShuttleNav() {
  const header = document.querySelector('.shuttle-nav-mobile-header');
  const content = document.getElementById('shuttle-nav-mobile-content');
  header.classList.toggle('active');
  content.classList.toggle('active');
}

// Load shuttle navigation from Ecwid
async function loadShuttleNavigation() {
  try {
    // For now, use a static navigation structure
    // This can be updated when we have a server-side endpoint
    const navHTML = `
      <div class="shuttle-nav-category">
        <div class="shuttle-nav-category-title">
          üìç View All Departure Towns
          <span>‚Ä∫</span>
        </div>
        <div class="shuttle-nav-subcategory">
          <a href="https://mallorcacycleshuttle.company.site/Departure-towns-c28971057" class="shuttle-nav-link" target="_blank">Browse All Shuttles</a>
          <a href="https://mallorcacycleshuttle.company.site/products/Scheduled-Bike-Buses-c15728235" class="shuttle-nav-link" target="_blank">View Schedule</a>
        </div>
      </div>
      <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem; font-size: 0.9rem; color: #666;">
        <p style="margin: 0;"><strong>üí° How it works:</strong></p>
        <p style="margin: 0.5rem 0 0 0;">Select your departure town, choose your route and date, then book your shuttle ticket.</p>
      </div>
    `;

    // Update both sidebar and mobile content
    document.getElementById('shuttle-nav-sidebar-content').innerHTML = navHTML;
    document.getElementById('shuttle-nav-loading-mobile').innerHTML = navHTML;

  } catch (error) {
    console.error('Error loading shuttle navigation:', error);
    const errorHTML = '<p style="color: #999;">Unable to load shuttle schedules. Please visit our <a href="https://mallorcacycleshuttle.company.site/products/Scheduled-Bike-Buses-c15728235" target="_blank">booking platform</a>.</p>';
    document.getElementById('shuttle-nav-sidebar-content').innerHTML = errorHTML;
    document.getElementById('shuttle-nav-loading-mobile').innerHTML = errorHTML;
  }
}

// Load shuttle navigation when page is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', loadShuttleNavigation);
} else {
  loadShuttleNavigation();
}
</script>
