{{ define "main" }}

  {{/* ========================================
       HERO SECTION - Full-width with gradient overlay
       ======================================== */}}
  <section class="homepage-hero">
    <div class="homepage-hero-overlay"></div>
    <div class="homepage-hero-image">
      {{- $heroImage := "/img/hero-main.webp" -}}
      {{- if eq .Params.translationKey "rescue-home" -}}
        {{- $heroImage = "/img/hero-rescue.webp" -}}
      {{- else if eq .Params.translationKey "airport-transfers" -}}
        {{- $heroImage = "/img/hero-airport.webp" -}}
      {{- else if .Params.hero_image -}}
        {{- $heroImage = .Params.hero_image -}}
      {{- end -}}
      <img src="{{ $heroImage }}" alt="{{ .Params.hero_title }}">
    </div>

    <div class="homepage-hero-content">
      <h1 class="homepage-hero-title">{{ .Params.hero_title }}</h1>
      <p class="homepage-hero-subtitle">{{ .Params.hero_subtitle }}</p>

      <div class="homepage-hero-ctas">
        {{ range .Params.hero_ctas }}
          <a href="{{ .url }}" class="homepage-cta-btn {{ .style }}">
            {{ .text }}
          </a>
        {{ end }}
      </div>
    </div>
  </section>

  {{/* ========================================
       SERVICE CARDS SECTION - 3 columns
       ======================================== */}}
  {{ with .Params.services }}
  <section class="homepage-services">
    <div class="container">
      <h2 class="homepage-section-title">{{ $.Params.services_title }}</h2>
      <div class="homepage-services-grid">
        {{ range . }}
        <div class="homepage-service-card fade-in-on-scroll">
          <div class="homepage-service-icon">
            <img src="{{ .icon }}" alt="{{ .title }}">
          </div>
          <h3>{{ .title }}</h3>
          <p>{{ .description }}</p>
          <a href="{{ .link }}" class="homepage-service-link">Learn More →</a>
        </div>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       ALTERNATING CONTENT BLOCKS
       ======================================== */}}
  {{ with .Params.content_blocks }}
  <section class="homepage-content-blocks">
    <div class="container">
      {{ range $index, $block := . }}
        <div class="homepage-content-block {{ if eq (mod $index 2) 0 }}image-right{{ else }}image-left{{ end }} fade-in-on-scroll">
          <div class="homepage-content-block-text">
            <h2>{{ $block.title }}</h2>
            <p>{{ $block.text }}</p>
            {{ if $block.cta }}
              <a href="{{ $block.cta.url }}" class="homepage-text-cta">{{ $block.cta.text }} →</a>
            {{ end }}
          </div>
          <div class="homepage-content-block-image">
            <img src="{{ $block.image }}" alt="{{ $block.title }}">
          </div>
        </div>
      {{ end }}
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       STATS SECTION - Counter animation
       ======================================== */}}
  {{ with .Params.stats }}
  <section class="homepage-stats">
    <div class="container">
      <div class="homepage-stats-grid">
        {{ range . }}
        <div class="homepage-stat-item fade-in-on-scroll">
          <div class="homepage-stat-number" data-target="{{ .number }}">0</div>
          <div class="homepage-stat-label">{{ .label }}</div>
        </div>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       FEATURED ROUTES SECTION
       ======================================== */}}
  {{ with .Params.featured_routes }}
  <section class="homepage-routes">
    <div class="container">
      <h2 class="homepage-section-title">{{ $.Params.routes_title }}</h2>
      <div class="homepage-routes-grid">
        {{ range . }}
        <a href="{{ .link }}" class="homepage-route-card fade-in-on-scroll">
          <div class="homepage-route-image">
            <img src="{{ .image }}" alt="{{ .title }}">
            {{ if .badge }}
              <span class="homepage-route-badge">{{ .badge }}</span>
            {{ end }}
          </div>
          <div class="homepage-route-content">
            <h3>{{ .title }}</h3>
            <p class="homepage-route-meta">{{ .distance }} • {{ .elevation }}</p>
          </div>
        </a>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       TESTIMONIALS SECTION
       ======================================== */}}
  {{ with .Params.testimonials }}
  <section class="homepage-testimonials">
    <div class="container">
      <h2 class="homepage-section-title">{{ $.Params.testimonials_title }}</h2>
      <div class="testimonials-carousel-wrapper">
        <button class="carousel-btn carousel-btn-prev" aria-label="Previous testimonials">‹</button>
        <div class="homepage-testimonials-carousel">
          <div class="testimonials-track">
            {{ range . }}
            <div class="homepage-testimonial-card">
              <div class="homepage-testimonial-stars">★★★★★</div>
              <p class="homepage-testimonial-text">"{{ .quote }}"</p>
              <div class="homepage-testimonial-author">
                <strong>{{ .name }}</strong>
                {{ if .location }}<span> • {{ .location }}</span>{{ end }}
              </div>
            </div>
            {{ end }}
          </div>
        </div>
        <button class="carousel-btn carousel-btn-next" aria-label="Next testimonials">›</button>
      </div>
      <div class="carousel-dots"></div>
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       FAQ ACCORDION
       ======================================== */}}
  {{ with .Params.faq }}
  <section class="homepage-faq">
    <div class="container">
      <h2 class="homepage-section-title">{{ $.Params.faq_title }}</h2>
      <div class="homepage-faq-grid">
        {{ range . }}
        <details class="faq-item">
          <summary>{{ .question }}</summary>
          <div class="answer">{{ .answer | markdownify }}</div>
        </details>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

  {{/* ========================================
       FINAL CTA BANNER
       ======================================== */}}
  {{ with .Params.final_cta }}
  <section class="homepage-final-cta">
    <div class="container">
      <div class="homepage-final-cta-content">
        <h2>{{ .title }}</h2>
        <p>{{ .subtitle }}</p>
        <a href="{{ .button_url }}" class="homepage-cta-btn primary">{{ .button_text }}</a>
      </div>
    </div>
  </section>
  {{ end }}

  {{/* Scroll animation script */}}
  <script>
    // Fade-in on scroll animation
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, observerOptions);

    document.querySelectorAll('.fade-in-on-scroll').forEach(el => {
      observer.observe(el);
    });

    // Stats counter animation
    const counters = document.querySelectorAll('.homepage-stat-number');
    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.classList.contains('counted')) {
          const target = parseFloat(entry.target.dataset.target);
          const hasDecimal = entry.target.dataset.target.includes('.');
          const duration = 2000;
          const step = target / (duration / 16);
          let current = 0;

          const timer = setInterval(() => {
            current += step;
            if (current >= target) {
              entry.target.textContent = hasDecimal ? target.toFixed(1) : target.toLocaleString();
              clearInterval(timer);
              entry.target.classList.add('counted');
            } else {
              entry.target.textContent = hasDecimal ? current.toFixed(1) : Math.floor(current).toLocaleString();
            }
          }, 16);
        }
      });
    }, { threshold: 0.5 });

    counters.forEach(counter => counterObserver.observe(counter));
  </script>

  <script>
    // Testimonials Carousel
    document.addEventListener('DOMContentLoaded', function() {
      const track = document.querySelector('.testimonials-track');
      const prevBtn = document.querySelector('.carousel-btn-prev');
      const nextBtn = document.querySelector('.carousel-btn-next');
      const dotsContainer = document.querySelector('.carousel-dots');

      if (!track || !prevBtn || !nextBtn || !dotsContainer) return;

      const cards = Array.from(track.children);
      const totalCards = cards.length;
      let currentPage = 0;
      let cardsPerView = getCardsPerView();
      let totalPages = Math.ceil(totalCards / cardsPerView);

      // Determine cards per view based on screen size
      function getCardsPerView() {
        if (window.innerWidth < 768) return 1;
        if (window.innerWidth < 1024) return 2;
        return 3;
      }

      function createDots() {
        dotsContainer.innerHTML = '';
        for (let i = 0; i < totalPages; i++) {
          const dot = document.createElement('button');
          dot.classList.add('carousel-dot');
          dot.setAttribute('aria-label', `Go to testimonials page ${i + 1}`);
          if (i === currentPage) dot.classList.add('active');
          dot.addEventListener('click', () => goToPage(i));
          dotsContainer.appendChild(dot);
        }
      }

      function updateCarousel() {
        const cardWidth = cards[0].offsetWidth;
        const gap = 32; // 2rem in pixels
        const offset = currentPage * (cardWidth + gap);
        track.style.transform = `translateX(-${offset}px)`;

        // Update dots
        const dots = Array.from(dotsContainer.children);
        dots.forEach((dot, index) => {
          dot.classList.toggle('active', index === currentPage);
        });

        // Update button states
        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = currentPage >= totalCards - cardsPerView;
        prevBtn.style.opacity = currentPage === 0 ? '0.5' : '1';
        nextBtn.style.opacity = currentPage >= totalCards - cardsPerView ? '0.5' : '1';
      }

      function goToPage(page) {
        currentPage = Math.min(page, totalCards - cardsPerView);
        updateCarousel();
      }

      function nextPage() {
        if (currentPage < totalCards - cardsPerView) {
          currentPage++;
          updateCarousel();
        }
      }

      function prevPage() {
        if (currentPage > 0) {
          currentPage--;
          updateCarousel();
        }
      }

      prevBtn.addEventListener('click', prevPage);
      nextBtn.addEventListener('click', nextPage);

      // Handle window resize
      let resizeTimer;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          const oldCardsPerView = cardsPerView;
          cardsPerView = getCardsPerView();

          if (oldCardsPerView !== cardsPerView) {
            totalPages = Math.ceil(totalCards / cardsPerView);
            currentPage = Math.min(currentPage, totalCards - cardsPerView);
            createDots();
          }

          updateCarousel();
        }, 250);
      });

      // Initial setup
      createDots();
      updateCarousel();
    });
  </script>

  {{/* ========================================
       APPLE CARD STYLE - Service Cards
       ======================================== */}}
  <style>
    /* ==================== APPLE 2025 CSS VARIABLES ==================== */
    :root {
      --font-system: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --brand-color: #f10000;
      --text-primary: #1d1d1f;
      --text-secondary: #6e6e73;
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f7;
      --border-light: #d2d2d7;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    /* ==================== SERVICE CARDS SECTION ==================== */
    .homepage-services {
      padding: 2rem 0 4rem 0;
      background: var(--bg-primary);
    }

    .homepage-section-title {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 3rem 0;
      letter-spacing: -0.02em;
      font-family: var(--font-system);
    }

    .homepage-services-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ==================== APPLE CARD STYLE ==================== */
    .homepage-service-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 2.5rem 2rem;
      transition: all var(--transition-fast);
      border: none;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .homepage-service-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      opacity: 0;
      transition: opacity var(--transition-fast);
      border-radius: var(--radius-lg);
      z-index: 0;
    }

    .homepage-service-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .homepage-service-card:hover::before {
      opacity: 1;
    }

    /* All content needs to be above the ::before overlay */
    .homepage-service-card > * {
      position: relative;
      z-index: 1;
    }

    /* ==================== SERVICE ICON ==================== */
    .homepage-service-icon {
      width: 64px;
      height: 64px;
      margin: 0 0 1.5rem 0;
      transition: transform var(--transition-fast);
    }

    .homepage-service-card:hover .homepage-service-icon {
      transform: translateY(-4px) scale(1.05);
    }

    .homepage-service-icon img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: contain;
    }

    /* ==================== SERVICE CONTENT ==================== */
    .homepage-service-card h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0 0 0.75rem 0;
      line-height: 1.3;
      letter-spacing: -0.01em;
      font-family: var(--font-system);
    }

    .homepage-service-card p {
      font-size: 1.0625rem;
      line-height: 1.6;
      color: var(--text-secondary);
      margin: 0 0 1.5rem 0;
      font-family: var(--font-system);
    }

    /* ==================== SERVICE LINK ==================== */
    .homepage-service-link {
      display: inline-flex;
      align-items: center;
      font-size: 1rem;
      font-weight: 600;
      color: var(--brand-color);
      text-decoration: none;
      transition: all var(--transition-fast);
      font-family: var(--font-system);
    }

    .homepage-service-link:hover {
      text-decoration: none;
      transform: translateX(4px);
    }

    /* ==================== FADE-IN ANIMATION ==================== */
    .fade-in-on-scroll {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .fade-in-on-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ==================== RESPONSIVE ==================== */
    @media (max-width: 1024px) {
      .homepage-services-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .homepage-services {
        padding: 1.5rem 0 3rem 0;
      }

      .homepage-section-title {
        font-size: 2rem;
        margin-bottom: 2rem;
      }

      .homepage-services-grid {
        grid-template-columns: 1fr;
        gap: 1.25rem;
      }

      .homepage-service-card {
        padding: 2rem 1.5rem;
      }

      .homepage-service-card h3 {
        font-size: 1.35rem;
      }

      .homepage-service-card p {
        font-size: 1rem;
      }
    }

    /* ==================== ROUTES SECTION ==================== */
    .homepage-routes {
      padding: 2.5rem 0 2rem 0;
      background: #f8f9fa;
    }

    @media (max-width: 768px) {
      .homepage-routes {
        padding: 1.25rem 0 2rem 0;
      }
    }

    /* ==================== CONTAINER ==================== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 1.5rem;
      }
    }
  </style>

{{ end }}
